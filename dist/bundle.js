!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=35)}([function(e,t,i){"use strict";const s=2.3283064365386963e-10;class n{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(e){return e=e<1?1/e:e,this._seed=e,this._s0=(e>>>0)*s,e=69069*e+1>>>0,this._s1=e*s,e=69069*e+1>>>0,this._s2=e*s,this._c=1,this}getUniform(){let e=2091639*this._s0+this._c*s;return this._s0=this._s1,this._s1=this._s2,this._c=0|e,this._s2=e-this._c,this._s2}getUniformInt(e,t){let i=Math.max(e,t),s=Math.min(e,t);return Math.floor(this.getUniform()*(i-s+1))+s}getNormal(e=0,t=1){let i,s,n;do{n=(i=2*this.getUniform()-1)*i+(s=2*this.getUniform()-1)*s}while(n>1||0==n);return e+i*Math.sqrt(-2*Math.log(n)/n)*t}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(e){return e.length?e[Math.floor(this.getUniform()*e.length)]:null}shuffle(e){let t=[],i=e.slice();for(;i.length;){let e=i.indexOf(this.getItem(i));t.push(i.splice(e,1)[0])}return t}getWeightedValue(e){let t=0;for(let i in e)t+=e[i];let i,s=this.getUniform()*t,n=0;for(i in e)if(s<(n+=e[i]))return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(e){return this._s0=e[0],this._s1=e[1],this._s2=e[2],this._c=e[3],this}clone(){return(new n).setState(this.getState())}}t.a=(new n).setSeed(Date.now())},function(e,t,i){"use strict";i.r(t),i.d(t,"DEFAULT_WIDTH",function(){return s}),i.d(t,"DEFAULT_HEIGHT",function(){return n}),i.d(t,"DIRS",function(){return o}),i.d(t,"KEYS",function(){return r});let s=80,n=25;const o={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},r={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Glyph=class{constructor(e,t,i){this.char=" ",this.foreground=[255,255,255],this.background=[0,0,0],this.char=e,this.background=t,this.foreground=i}}},function(e,t,i){"use strict";var s=i(27),n=i(65),o=Object.prototype.toString;function r(e){return"[object Array]"===o.call(e)}function a(e){return null!==e&&"object"==typeof e}function h(e){return"[object Function]"===o.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),r(e))for(var i=0,s=e.length;i<s;i++)t.call(null,e[i],i,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}e.exports={isArray:r,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:n,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:h,isStream:function(e){return a(e)&&h(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function i(i,s){"object"==typeof t[s]&&"object"==typeof i?t[s]=e(t[s],i):t[s]=i}for(var s=0,n=arguments.length;s<n;s++)l(arguments[s],i);return t},deepMerge:function e(){var t={};function i(i,s){"object"==typeof t[s]&&"object"==typeof i?t[s]=e(t[s],i):t[s]="object"==typeof i?e({},i):i}for(var s=0,n=arguments.length;s<n;s++)l(arguments[s],i);return t},extend:function(e,t,i){return l(t,function(t,n){e[n]=i&&"function"==typeof t?s(t,i):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2);t.deathFunction=function(e){if(null!=e.fighter){let t=new s.Glyph("%",[0,0,0],[139,0,0]);e.glyph=t,e.blocks=!1,e.render_order=99,e.fighter.status="dead"}null!=e.damage&&(e.damage.expire=!0)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(13),n=i(7),o=i(2);t.createDamageBlock=function(e,t,i,r,a,h="╳",l=6){e.face;let c=new n.DamageBlock(a,l),u=null;return!e._map.getTile(t,i)._isWalkable||(c.owner=e,(u=e.player?new s.Entity(t,i,new o.Glyph(h,[0,0,0],[e.glyph.foreground[1],e.glyph.foreground[1]/3,e.glyph.foreground[2]/3]),r,1,!1,0,5,void 0,void 0,!1,void 0,void 0,c):new s.Entity(t,i,new o.Glyph(h,[0,0,0],[150,e.glyph.foreground[1]/3,e.glyph.foreground[2]/3]),r,1,!1,0,5,void 0,void 0,!1,void 0,void 0,c))._map=e._map,u.damage.startCountDown(),u.owner=e,e._map._entities.push(u),!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Equipment=class{constructor(e){this.expire=!1,this.prefix="",this.type=e}strike(){}defend(e){return e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4);t.DamageBlock=class{constructor(e,t=6){this.expire=!1,this.multiplier=e,this.timeout=t}startCountDown(){var e=this.timeout,t=setInterval(()=>{if(2==--e){let e=this.owner.glyph.foreground.map(e=>e=4*e>250?250:4*e);this.owner.glyph.foreground=[250,e[1],e[2]]}if(0==e){clearInterval(t);let e=this.owner._map.getEntitiesAt(this.owner.x,this.owner.x2,this.owner.y,this.owner.y2,this.owner);e.length>0&&this.owner.skill(e),s.deathFunction(this.owner)}},100)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(24);t.qualityGenerator=function(e){let t={power_bonus:0,skill_bonus:0,defense_bonus:0,max_cooldown:0,prefix:"",alpha:0};t.power_bonus=s.randperc(30),t.skill_bonus=s.randperc(30),t.defense_bonus=s.randperc(30),t.max_cooldown=s.randperc(40);let i=100*t.power_bonus+100*t.skill_bonus+100*t.defense_bonus+100*t.max_cooldown;return i<=-60?t.prefix="crappy ":i<-30?t.prefix="inferior ":i<-15?t.prefix="weak ":i<15?t.prefix="":i<30?t.prefix="strong ":i<45?t.prefix="superior ":i<60?t.prefix="legendary ":i>=60&&(t.prefix="infinite "),t.alpha=180+180*Math.ceil(i/100),"main"==e&&(100*t.power_bonus>13?t.prefix+="fierce ":100*t.skill_bonus>13?t.prefix+="skillful ":100*t.defense_bonus>13?t.prefix+="parry ":100*t.max_cooldown>17&&(t.prefix+="quick ")),"sub"==e&&(100*t.power_bonus>13?t.prefix+="empowered ":100*t.skill_bonus>13?t.prefix+="enchanted ":100*t.defense_bonus>13?t.prefix+="vanguard ":100*t.max_cooldown>17&&(t.prefix+="lightweight ")),t}},function(e,t,i){"use strict";function s(e,t){return(e%t+t)%t}function n(e,t=0,i=1){return e<t?t:e>i?i:e}function o(e){return e.charAt(0).toUpperCase()+e.substring(1)}function r(e,...t){let i=r.map;return e.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(s,n,r,a){if("%"==e.charAt(a-1))return s.substring(1);if(!t.length)return s;let h=t[0],l=(n||r).split(","),c=l.shift()||"",u=i[c.toLowerCase()];if(!u)return s;let _=(h=t.shift())[u].apply(h,l),d=c.charAt(0);return d!=d.toLowerCase()&&(_=o(_)),_})}i.r(t),i.d(t,"mod",function(){return s}),i.d(t,"clamp",function(){return n}),i.d(t,"capitalize",function(){return o}),i.d(t,"format",function(){return r}),r.map={s:"toString"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randint=function(e,t){let i=Math.random()*(t-e+1)+e-.5;return Math.round(i)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5);t.poison_cloud=function(e,t,i){let n="spore cloud";s.createDamageBlock(e,t.x,t.y,n,i,"ꙮ"),s.createDamageBlock(e,t.x+1,t.y,n,i,"ꙮ"),s.createDamageBlock(e,t.x-1,t.y,n,i,"ꙮ"),s.createDamageBlock(e,t.x,t.y+1,n,i,"ꙮ"),s.createDamageBlock(e,t.x,t.y-1,n,i,"ꙮ")},t.poison_shield=function(e,t,i){let n="spore shield";s.createDamageBlock(e,e.x+1,e.y-1,n,i),s.createDamageBlock(e,e.x+1,e.y,n,i),s.createDamageBlock(e,e.x+1,e.y+1,n,i),s.createDamageBlock(e,e.x,e.y+1,n,i),s.createDamageBlock(e,e.x,e.y-1,n,i),s.createDamageBlock(e,e.x-1,e.y-1,n,i),s.createDamageBlock(e,e.x-1,e.y,n,i),s.createDamageBlock(e,e.x-1,e.y+1,n,i)},t.hug=function(e,t,i){"n"==e.face&&(s.createDamageBlock(e,e.x,e.y-1,"hug",i,"❤"),s.createDamageBlock(e,e.x,e.y-2,"hug",i,"❤"),s.createDamageBlock(e,e.x,e.y-3,"hug",i,"❤"),s.createDamageBlock(e,e.x,e.y-4,"hug",i,"❤")),"s"==e.face&&(s.createDamageBlock(e,e.x,e.y+1,"hug",i,"❤"),s.createDamageBlock(e,e.x,e.y+2,"hug",i,"❤"),s.createDamageBlock(e,e.x,e.y+3,"hug",i,"❤"),s.createDamageBlock(e,e.x,e.y+4,"hug",i,"❤")),"w"==e.face&&(s.createDamageBlock(e,e.x-1,e.y,"hug",i,"❤"),s.createDamageBlock(e,e.x-2,e.y,"hug",i,"❤"),s.createDamageBlock(e,e.x-3,e.y,"hug",i,"❤"),s.createDamageBlock(e,e.x-4,e.y,"hug",i,"❤")),"e"==e.face&&(s.createDamageBlock(e,e.x+1,e.y,"hug",i,"❤"),s.createDamageBlock(e,e.x+2,e.y,"hug",i,"❤"),s.createDamageBlock(e,e.x+3,e.y,"hug",i,"❤"),s.createDamageBlock(e,e.x+4,e.y,"hug",i,"❤"))},t.punch=function(e,t,i){"n"==e.face&&(s.createDamageBlock(e,e.x,e.y-1,"smite",i),s.createDamageBlock(e,e.x,e.y-2,"smite",i),s.createDamageBlock(e,e.x,e.y-3,"smite",i),s.createDamageBlock(e,e.x,e.y-4,"smite",i)),"s"==e.face&&(s.createDamageBlock(e,e.x,e.y+1,"smite",i),s.createDamageBlock(e,e.x,e.y+2,"smite",i),s.createDamageBlock(e,e.x,e.y+3,"smite",i),s.createDamageBlock(e,e.x,e.y+4,"smite",i)),"w"==e.face&&(s.createDamageBlock(e,e.x-1,e.y,"smite",i),s.createDamageBlock(e,e.x-2,e.y,"smite",i),s.createDamageBlock(e,e.x-3,e.y,"smite",i),s.createDamageBlock(e,e.x-4,e.y,"smite",i)),"e"==e.face&&(s.createDamageBlock(e,e.x+1,e.y,"smite",i),s.createDamageBlock(e,e.x+2,e.y,"smite",i),s.createDamageBlock(e,e.x+3,e.y,"smite",i),s.createDamageBlock(e,e.x+4,e.y,"smite",i))},t.smash=function(e,t,i){"n"==e.face&&(s.createDamageBlock(e,e.x,e.y-1,"smash",i,"✶"),s.createDamageBlock(e,e.x,e.y-2,"smash",i,"✶"),s.createDamageBlock(e,e.x,e.y-3,"smash",i,"✶"),s.createDamageBlock(e,e.x,e.y-4,"smash",i,"✶"),s.createDamageBlock(e,e.x-1,e.y-4,"smash",i,"✶"),s.createDamageBlock(e,e.x+1,e.y-4,"smash",i,"✶")),"s"==e.face&&(s.createDamageBlock(e,e.x,e.y+1,"smash",i,"✶"),s.createDamageBlock(e,e.x,e.y+2,"smash",i,"✶"),s.createDamageBlock(e,e.x,e.y+3,"smash",i,"✶"),s.createDamageBlock(e,e.x,e.y+4,"smash",i,"✶"),s.createDamageBlock(e,e.x-1,e.y+4,"smash",i,"✶"),s.createDamageBlock(e,e.x+1,e.y+4,"smash",i,"✶")),"w"==e.face&&(s.createDamageBlock(e,e.x-1,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x-2,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x-3,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x-4,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x-4,e.y+1,"smash",i,"✶"),s.createDamageBlock(e,e.x-4,e.y-1,"smash",i,"✶")),"e"==e.face&&(s.createDamageBlock(e,e.x+1,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x+2,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x+3,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x+4,e.y,"smash",i,"✶"),s.createDamageBlock(e,e.x+4,e.y+1,"smash",i,"✶"),s.createDamageBlock(e,e.x+4,e.y-1,"smash",i,"✶"))},t.windBlow=function(e,t,i){s.createDamageBlock(e,t.x,t.y,"wind blow",i,"ꙮ"),s.createDamageBlock(e,t.x+1,t.y+1,"wind blow",i,"ꙮ"),s.createDamageBlock(e,t.x-1,t.y-1,"wind blow",i,"ꙮ"),s.createDamageBlock(e,t.x-1,t.y+1,"wind blow",i,"ꙮ"),s.createDamageBlock(e,t.x+1,t.y-1,"wind blow",i,"ꙮ")},t.snipe=function(e,t,i){let n=t.x-e.x,o=t.y-e.y,r=!1;Math.abs(n)<Math.abs(o)&&(o>0?(r||(r=s.createDamageBlock(e,e.x,e.y+2,"shot",i,"↓",6)),r||(r=s.createDamageBlock(e,e.x,e.y+3,"shot",i,"↓",7)),r||(r=s.createDamageBlock(e,e.x,e.y+4,"shot",i,"↓",8)),r||(r=s.createDamageBlock(e,e.x,e.y+5,"shot",i,"↓",9)),r||(r=s.createDamageBlock(e,e.x,e.y+6,"shot",i,"↓",10)),r||(r=s.createDamageBlock(e,e.x,e.y+7,"shot",i,"↓",11)),r||(r=s.createDamageBlock(e,e.x,e.y+8,"shot",i,"↓",12)),r||(r=s.createDamageBlock(e,e.x,e.y+9,"shot",i,"↓",13)),r||(r=s.createDamageBlock(e,e.x,e.y+10,"shot",i,"↓",14)),r||(r=s.createDamageBlock(e,e.x,e.y+11,"shot",i,"↓",15))):(r||(r=s.createDamageBlock(e,e.x,e.y-2,"shot",i,"↑",6)),r||(r=s.createDamageBlock(e,e.x,e.y-3,"shot",i,"↑",7)),r||(r=s.createDamageBlock(e,e.x,e.y-4,"shot",i,"↑",8)),r||(r=s.createDamageBlock(e,e.x,e.y-5,"shot",i,"↑",9)),r||(r=s.createDamageBlock(e,e.x,e.y-6,"shot",i,"↑",10)),r||(r=s.createDamageBlock(e,e.x,e.y-7,"shot",i,"↑",11)),r||(r=s.createDamageBlock(e,e.x,e.y-8,"shot",i,"↑",12)),r||(r=s.createDamageBlock(e,e.x,e.y-9,"shot",i,"↑",13)),r||(r=s.createDamageBlock(e,e.x,e.y-10,"shot",i,"↑",14)),r||(r=s.createDamageBlock(e,e.x,e.y-11,"shot",i,"↑",15)))),Math.abs(n)>Math.abs(o)&&(n>0?(r||(r=s.createDamageBlock(e,e.x+2,e.y,"shot",i,"→",6)),r||(r=s.createDamageBlock(e,e.x+3,e.y,"shot",i,"→",7)),r||(r=s.createDamageBlock(e,e.x+4,e.y,"shot",i,"→",8)),r||(r=s.createDamageBlock(e,e.x+5,e.y,"shot",i,"→",9)),r||(r=s.createDamageBlock(e,e.x+6,e.y,"shot",i,"→",10)),r||(r=s.createDamageBlock(e,e.x+7,e.y,"shot",i,"→",11)),r||(r=s.createDamageBlock(e,e.x+8,e.y,"shot",i,"→",12)),r||(r=s.createDamageBlock(e,e.x+9,e.y,"shot",i,"→",13)),r||(r=s.createDamageBlock(e,e.x+10,e.y,"shot",i,"→",14)),r||(r=s.createDamageBlock(e,e.x+11,e.y,"shot",i,"→",15))):(r||(r=s.createDamageBlock(e,e.x-2,e.y,"shot",i,"←",6)),r||(r=s.createDamageBlock(e,e.x-3,e.y,"shot",i,"←",7)),r||(r=s.createDamageBlock(e,e.x-4,e.y,"shot",i,"←",8)),r||(r=s.createDamageBlock(e,e.x-5,e.y,"shot",i,"←",9)),r||(r=s.createDamageBlock(e,e.x-6,e.y,"shot",i,"←",10)),r||(r=s.createDamageBlock(e,e.x-7,e.y,"shot",i,"←",11)),r||(r=s.createDamageBlock(e,e.x-8,e.y,"shot",i,"←",12)),r||(r=s.createDamageBlock(e,e.x-9,e.y,"shot",i,"←",13)),r||(r=s.createDamageBlock(e,e.x-10,e.y,"shot",i,"←",14)),r||(r=s.createDamageBlock(e,e.x-11,e.y,"shot",i,"←",15))))},t.flamestrike=function(e,t,i){let n="flamestrike";"n"==e.face&&(s.createDamageBlock(e,e.x-2,e.y-1,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y-1,n,i,"⽕"),s.createDamageBlock(e,e.x,e.y-1,n,i,"⽕"),s.createDamageBlock(e,e.x,e.y-2,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y-1,n,i,"⽕"),s.createDamageBlock(e,e.x+1,e.y-1,n,i,"⽕")),"s"==e.face&&(s.createDamageBlock(e,e.x,e.y+1,n,i,"⽕"),s.createDamageBlock(e,e.x,e.y+2,n,i,"⽕"),s.createDamageBlock(e,e.x-2,e.y+1,n,i,"⽕"),s.createDamageBlock(e,e.x+2,e.y+1,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y+1,n,i,"⽕"),s.createDamageBlock(e,e.x+1,e.y+1,n,i,"⽕")),"w"==e.face&&(s.createDamageBlock(e,e.x-1,e.y,n,i,"⽕"),s.createDamageBlock(e,e.x-2,e.y,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y+2,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y-2,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y+1,n,i,"⽕"),s.createDamageBlock(e,e.x-1,e.y-1,n,i,"⽕")),"e"==e.face&&(s.createDamageBlock(e,e.x+1,e.y,n,i,"⽕"),s.createDamageBlock(e,e.x+2,e.y,n,i,"⽕"),s.createDamageBlock(e,e.x+1,e.y-2,n,i,"⽕"),s.createDamageBlock(e,e.x+1,e.y+2,n,i,"⽕"),s.createDamageBlock(e,e.x+1,e.y+1,n,i,"⽕"),s.createDamageBlock(e,e.x+1,e.y-1,n,i,"⽕"))},t.bite=function(e,t,i){"n"==e.face&&(s.createDamageBlock(e,e.x-1,e.y-1,"bite",i,"✖"),s.createDamageBlock(e,e.x,e.y-1,"bite",i,"✖"),s.createDamageBlock(e,e.x+1,e.y-1,"bite",i,"✖"),s.createDamageBlock(e,e.x,e.y-2,"bite",i,"✖")),"s"==e.face&&(s.createDamageBlock(e,e.x-1,e.y+1,"bite",i,"✖"),s.createDamageBlock(e,e.x,e.y+1,"bite",i,"✖"),s.createDamageBlock(e,e.x-1,e.y+1,"bite",i,"✖"),s.createDamageBlock(e,e.x,e.y+2,"bite",i,"✖")),"w"==e.face&&(s.createDamageBlock(e,e.x-1,e.y+1,"bite",i,"✖"),s.createDamageBlock(e,e.x-1,e.y,"bite",i,"✖"),s.createDamageBlock(e,e.x-1,e.y-1,"bite",i,"✖"),s.createDamageBlock(e,e.x-2,e.y,"bite",i,"✖")),"e"==e.face&&(s.createDamageBlock(e,e.x+1,e.y-1,"bite",i,"✖"),s.createDamageBlock(e,e.x+1,e.y,"bite",i,"✖"),s.createDamageBlock(e,e.x+1,e.y+1,"bite",i,"✖"),s.createDamageBlock(e,e.x+2,e.y,"bite",i,"✖"))},t.firebreath=function(e,t,i){let n="firebreath",o=t.x-e.x,r=t.y-e.y,a=!1;Math.abs(o)<Math.abs(r)&&(r>0?(a||(a=s.createDamageBlock(e,e.x,e.y+1,n,i,"⮇",5)),a||(a=s.createDamageBlock(e,e.x+1,e.y+2,n,i,"⮇",6)),a||(a=s.createDamageBlock(e,e.x,e.y+2,n,i,"⮇",6)),a||(a=s.createDamageBlock(e,e.x-1,e.y+2,n,i,"⮇",6)),a||(a=s.createDamageBlock(e,e.x+1,e.y+3,n,i,"⮇",7)),a||(a=s.createDamageBlock(e,e.x,e.y+3,n,i,"⮇",7)),a||(a=s.createDamageBlock(e,e.x-1,e.y+3,n,i,"⮇",7)),a||(a=s.createDamageBlock(e,e.x+2,e.y+4,n,i,"⮇",9)),a||(a=s.createDamageBlock(e,e.x+1,e.y+4,n,i,"⮇",9)),a||(a=s.createDamageBlock(e,e.x,e.y+4,n,i,"⮇",9)),a||(a=s.createDamageBlock(e,e.x-1,e.y+4,n,i,"⮇",9)),a||(a=s.createDamageBlock(e,e.x-2,e.y+4,n,i,"⮇",9))):(a||(a=s.createDamageBlock(e,e.x,e.y-1,n,i,"⮅",5)),a||(a=s.createDamageBlock(e,e.x+1,e.y-2,n,i,"⮅",6)),a||(a=s.createDamageBlock(e,e.x,e.y-2,n,i,"⮅",6)),a||(a=s.createDamageBlock(e,e.x-1,e.y-2,n,i,"⮅",6)),a||(a=s.createDamageBlock(e,e.x+1,e.y-3,n,i,"⮅",7)),a||(a=s.createDamageBlock(e,e.x,e.y-3,n,i,"⮅",7)),a||(a=s.createDamageBlock(e,e.x-1,e.y-3,n,i,"⮅",7)),a||(a=s.createDamageBlock(e,e.x+2,e.y-4,n,i,"⮅",8)),a||(a=s.createDamageBlock(e,e.x+1,e.y-4,n,i,"⮅",8)),a||(a=s.createDamageBlock(e,e.x,e.y-4,n,i,"⮅",8)),a||(a=s.createDamageBlock(e,e.x-1,e.y-4,n,i,"⮅",8)),a||(a=s.createDamageBlock(e,e.x-2,e.y-4,n,i,"⮅",8)))),Math.abs(o)>Math.abs(r)&&(o>0?(a||(a=s.createDamageBlock(e,e.x+1,e.y,n,i,"⮆",5)),a||(a=s.createDamageBlock(e,e.x+2,e.y+1,n,i,"⮆",6)),a||(a=s.createDamageBlock(e,e.x+2,e.y,n,i,"⮆",6)),a||(a=s.createDamageBlock(e,e.x+2,e.y-1,n,i,"⮆",6)),a||(a=s.createDamageBlock(e,e.x+3,e.y+1,n,i,"⮆",7)),a||(a=s.createDamageBlock(e,e.x+3,e.y,n,i,"⮆",7)),a||(a=s.createDamageBlock(e,e.x+3,e.y-1,n,i,"⮆",7)),a||(a=s.createDamageBlock(e,e.x+4,e.y+2,n,i,"⮆",8)),a||(a=s.createDamageBlock(e,e.x+4,e.y+1,n,i,"⮆",8)),a||(a=s.createDamageBlock(e,e.x+4,e.y,n,i,"⮆",8)),a||(a=s.createDamageBlock(e,e.x+4,e.y-1,n,i,"⮆",8)),a||(a=s.createDamageBlock(e,e.x+4,e.y-2,n,i,"⮆",8))):(a||(a=s.createDamageBlock(e,e.x-1,e.y,n,i,"⮄",5)),a||(a=s.createDamageBlock(e,e.x-2,e.y+1,n,i,"⮄",6)),a||(a=s.createDamageBlock(e,e.x-2,e.y,n,i,"⮄",6)),a||(a=s.createDamageBlock(e,e.x-2,e.y-1,n,i,"⮄",6)),a||(a=s.createDamageBlock(e,e.x-3,e.y+1,n,i,"⮄",7)),a||(a=s.createDamageBlock(e,e.x-3,e.y,n,i,"⮄",7)),a||(a=s.createDamageBlock(e,e.x-3,e.y-1,n,i,"⮄",7)),a||(a=s.createDamageBlock(e,e.x-4,e.y+2,n,i,"⮄",8)),a||(a=s.createDamageBlock(e,e.x-4,e.y+1,n,i,"⮄",8)),a||(a=s.createDamageBlock(e,e.x-4,e.y,n,i,"⮄",8)),a||(a=s.createDamageBlock(e,e.x-4,e.y-1,n,i,"⮄",8)),a||(a=s.createDamageBlock(e,e.x-4,e.y-2,n,i,"⮄",8))))}},function(e,t,i){"use strict";i.r(t),i.d(t,"fromString",function(){return o}),i.d(t,"add",function(){return r}),i.d(t,"add_",function(){return a}),i.d(t,"multiply",function(){return h}),i.d(t,"multiply_",function(){return l}),i.d(t,"interpolate",function(){return c}),i.d(t,"lerp",function(){return u}),i.d(t,"interpolateHSL",function(){return _}),i.d(t,"lerpHSL",function(){return d}),i.d(t,"randomize",function(){return m}),i.d(t,"rgb2hsl",function(){return p}),i.d(t,"hsl2rgb",function(){return f}),i.d(t,"toRGB",function(){return w}),i.d(t,"toHex",function(){return y});var s=i(9),n=i(0);function o(e){let t,i;if(e in x)t=x[e];else{if("#"==e.charAt(0)){let i=(e.match(/[0-9a-f]/gi)||[]).map(e=>parseInt(e,16));if(3==i.length)t=i.map(e=>17*e);else{for(let e=0;e<3;e++)i[e+1]+=16*i[e],i.splice(e,1);t=i}}else t=(i=e.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(e=>parseInt(e)):[0,0,0];x[e]=t}return t.slice()}function r(e,...t){let i=e.slice();for(let e=0;e<3;e++)for(let s=0;s<t.length;s++)i[e]+=t[s][e];return i}function a(e,...t){for(let i=0;i<3;i++)for(let s=0;s<t.length;s++)e[i]+=t[s][i];return e}function h(e,...t){let i=e.slice();for(let e=0;e<3;e++){for(let s=0;s<t.length;s++)i[e]*=t[s][e]/255;i[e]=Math.round(i[e])}return i}function l(e,...t){for(let i=0;i<3;i++){for(let s=0;s<t.length;s++)e[i]*=t[s][i]/255;e[i]=Math.round(e[i])}return e}function c(e,t,i=.5){let s=e.slice();for(let n=0;n<3;n++)s[n]=Math.round(s[n]+i*(t[n]-e[n]));return s}const u=c;function _(e,t,i=.5){let s=p(e),n=p(t);for(let e=0;e<3;e++)s[e]+=i*(n[e]-s[e]);return f(s)}const d=_;function m(e,t){t instanceof Array||(t=Math.round(n.a.getNormal(0,t)));let i=e.slice();for(let e=0;e<3;e++)i[e]+=t instanceof Array?Math.round(n.a.getNormal(0,t[e])):t;return i}function p(e){let t,i=e[0]/255,s=e[1]/255,n=e[2]/255,o=Math.max(i,s,n),r=Math.min(i,s,n),a=0,h=(o+r)/2;if(o==r)t=0;else{let e=o-r;switch(t=h>.5?e/(2-o-r):e/(o+r),o){case i:a=(s-n)/e+(s<n?6:0);break;case s:a=(n-i)/e+2;break;case n:a=(i-s)/e+4}a/=6}return[a,t,h]}function g(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function f(e){let t=e[2];if(0==e[1])return[t=Math.round(255*t),t,t];{let i=e[1],s=t<.5?t*(1+i):t+i-t*i,n=2*t-s,o=g(n,s,e[0]+1/3),r=g(n,s,e[0]),a=g(n,s,e[0]-1/3);return[Math.round(255*o),Math.round(255*r),Math.round(255*a)]}}function w(e){return`rgb(${e.map(e=>Object(s.clamp)(e,0,255)).join(",")})`}function y(e){return`#${e.map(e=>Object(s.clamp)(e,0,255).toString(16).padStart(2,"0")).join("")}`}const x={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(18),n=i(10),o=i(4),r=i(15);class a{constructor(e,t,i,s,n=0,o=!1,r=0,a=99,h,l,c=!1,u,_,d,m,p,g,f,w,y){this.regen=void 0,this.regenMax=10,this.lastxp=0,this.killedby="",this.x=e,this.y=t,this.x2=e+n-1,this.y2=t+n-1,this.glyph=i,this.name=s,this.blocks=o,this.render_order=a,this.maxStamina=r,this.stamina=0,this._map=w,this.ai=l,this.fighter=h,this.equipment=g,this.subequipment=void 0,this.cooldown=0,this.face="n",this.damage=d,this.player=c,this.item=u,this.inventory=1,this.stairs=m,this.boss=f,1==this.player&&(this.startMoveCountDown(),this.startAttackCountDown()),null!=this.ai?(this.ai.owner=this,this.ai.startCountDown(this.maxStamina),this.sight=10,this.startAttackCountDown()):this.sight=12,null!=this.fighter&&(this.fighter.owner=this),null!=this.equipment&&(this.equipment.owner=this),null!=this.damage&&(this.damage.owner=this),null!=this.item&&(this.item.owner=this),null!=this.inventory&&(this.inventory=1)}move(e,t,i){this.changeFace(e,t);let s=this.x+e,n=this.x2+e,o=this.y+t,r=this.y2+t;if((0!=e||0!=t)&&i.getMovableArea(s,n,o,r)){let e=[];0==(e=i.getEntitiesAt(s,n,o,r,this)).length?(this.x=s,this.x2=n,this.y=o,this.y2=r):1==this.player?0==this.cooldown&&(this.attack(e),this.cooldown=5):0==this.cooldown&&(this.attack(e),this.cooldown=20)}}angelMove(e,t,i){let s=this.changeFace(e,t),n=[e,t];if(1==this.player&&this.stamina<this.maxStamina&&s)return;1==this.player&&(this.stamina=0);let o=this.x+e,r=this.x2+e,a=this.y+t,h=this.y2+t;if(0==e&&0==t)return;let l=[];if(0==(l=i.getEntitiesAt(o,r,a,h,this)).length)this.x=o,this.x2=r,this.y=a,this.y2=h;else{if(1!=this.player)return this.attack(l),[n[0],n[1]];0==this.cooldown&&(this.attack(l),this.cooldown=5)}return this.x2>=55&&(n=[-2,n[1]]),this.x<=10&&(n=[2,n[1]]),this.y<=3&&(n=[n[0],2]),this.y2>=35&&(n=[n[0],-2]),n}changeFace(e,t){return-1==e?"w"==this.face||(this.face="w",!1):1==e?"e"==this.face||(this.face="e",!1):-1==t?"n"==this.face||(this.face="n",!1):1==t?"s"==this.face||(this.face="s",!1):void 0}startMoveCountDown(){var e=setInterval(()=>{this.stamina<=this.maxStamina&&this.stamina++,0==this.fighter.hp&&(clearInterval(e),o.deathFunction(this))},100)}startAttackCountDown(){var e=setInterval(()=>{this.cooldown>0&&this.cooldown--,0==this.fighter.hp&&(clearInterval(e),o.deathFunction(this))},100)}equipStart(e){this.equipment=e.item,this.equipment.owner=this,e.item.expire=!0}equip(e){if("main"==e.item.type)if(null==this.equipment)this.equipment=e.item,this.equipment.owner=this,e.item.expire=!0,this._map.messageLog.newMessage(this,"pickup",e);else{let t=r.CreateDropItem(this.equipment,this.x,this.y),i=new a(this.x,this.y,t.item.glyph,t.item.fullname,1,!1,5,2,void 0,void 0,!1,t.item);this._map._entities.push(i),this.equipment=e.item,this.equipment.owner=this,e.item.expire=!0,this._map.messageLog.newMessage(this,"switchEquip",i,e),this.fighter.hp>this.fighter.max_hp()&&(this.fighter.hp=this.fighter.max_hp())}else if("sub"==e.item.type)if(null==this.subequipment)this.subequipment=e.item,this.subequipment.owner=this,e.item.expire=!0,this._map.messageLog.newMessage(this,"pickup",e);else{let t=r.CreateDropItem(this.subequipment,this.x,this.y),i=new a(this.x,this.y,t.item.glyph,t.item.fullname,1,!1,5,2,void 0,void 0,!1,t.item);this._map._entities.push(i),this.subequipment=e.item,this.subequipment.owner=this,e.item.expire=!0,this._map.messageLog.newMessage(this,"switchEquip",i,e),this.fighter.hp>this.fighter.max_hp()&&(this.fighter.hp=this.fighter.max_hp())}else"bag"==e.item.type&&(0==e.item.expire&&(this.inventory+=1,this._map.messageLog.newMessage(this,"pickup",e)),e.item.expire=!0)}usePotion(){0!=this.inventory?(this._map.messageLog.newMessage(this,"potion"),this.inventory-=1,null==this.regen&&(this.regen=setInterval(()=>{this.regenMax>0&&(this.fighter.heal(.035*this.fighter.max_hp()),this.regenMax-=1),0==this.regenMax&&(this.regenMax=10,clearInterval(this.regen),this.regen=void 0)},500))):this._map.messageLog.newMessage(this,"potionZero")}attack(e){if(null!=this.fighter)if("@"==this.glyph.char)this.fighter.attack(e[0]);else{let t=void 0;e.forEach(e=>{"@"==e.glyph.char&&(t=e)}),null!=t&&this.fighter.attack(t)}}skill(e){e.forEach((e,t)=>{e!=this.owner&&null!=e.fighter&&this.owner.fighter.equipment_skill(e,this)})}hunt(e){let t=this;var i=new s.Path.AStar(e.x,e.y,function(e,i){return!(t._map.getEntitiesAt(this.x1,this.x2,this.y1,this.y2,this).length>0)&&t._map.getTile(e,i)._isWalkable},{topology:8}),n=0;i.compute(t.x,t.y,function(e,i){if(1==n){let s=e-t.x,n=i-t.y;t.move(s,n,t._map)}n>1||n++})}wander(){let e=0,t=0;for(;0==e&&0==t;)e=n.randint(-1,1),t=n.randint(-1,1);this.move(t,e,this._map)}kite(e){let t=this,i=this.x-(e.x-this.x),n=this.y-(e.y-this.y);var o=new s.Path.AStar(i,n,function(e,s){if(i>this._width-1||i<1)return!1;if(n>this._height-1||n<1)return!1;return!(t._map.getEntitiesAt(this.x1,this.x2,this.y1,this.y2,this).length>0)&&t._map.getTile(e,s)._isWalkable},{topology:8}),r=0;o.compute(t.x,t.y,function(e,i){if(1==r){let s=e-t.x,n=i-t.y;t.move(s,n,t._map)}r>1||r++})}act(){}}t.Entity=a},function(e,t,i){"use strict";i.d(t,"a",function(){return s});class s{getContainer(){return null}setOptions(e){this._options=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(13),n=i(23),o=i(2),r=i(38),a=i(39),h=i(40),l=i(41),c=i(42),u=i(43),_=i(44),d=i(45),m=i(46),p=i(47),g=i(10);t.CreateItem=function(e,t,i,f){let w,y=[0,0,0,0,0];for(let e=0;e<f;e++)y[g.randint(0,4)]+=1;if("potion"==e){w=new l.Potion;let e=new s.Entity(t,i,new o.Glyph("ზ",[0,0,0],[50,200,50]),w.name,1,!1,5,2,void 0,void 0,!1,w);return e.item.glyph=e.glyph,e}"knife"==e?w=new n.Knife(void 0,y):"sword"==e?w=new r.Sword(void 0,y):"spear"==e?w=new a.Spear(void 0,y):"dagger"==e?w=new u.Dagger(void 0,y):"firerod"==e?w=new c.Firerod(void 0,y):"icerod"==e?w=new _.Icerod(void 0,y):"crossedswords"==e?w=new d.CrossedSwords(void 0,y):"shield"==e?w=new h.Shield(void 0,y):"offdagger"==e?w=new m.Offdagger(void 0,y):"blademail"==e&&(w=new p.Blademail(void 0,y));let x=new s.Entity(t,i,w.glyph,w.fullname,1,!1,5,2,void 0,void 0,!1,w);return x.item.glyph=x.glyph,x},t.CreateDropItem=function(e,t,i){let o=e.name;if("knife"==o){let o=new n.Knife(e),r=new s.Entity(t,i,o.glyph,o.fullname,1,!1,5,2,void 0,void 0,!1,o);return r.item.glyph=e.glyph,r}if("sword"==o){let n=new r.Sword(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("spear"==o){let n=new a.Spear(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("dagger"==o){let n=new u.Dagger(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("firerod"==o){let n=new c.Firerod(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("icerod"==o){let n=new _.Icerod(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("crossedswords"==o){let n=new d.CrossedSwords(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("shield"==o){let n=new h.Shield(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("offdagger"==o){let n=new m.Offdagger(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}if("blademail"==o){let n=new p.Blademail(e),o=new s.Entity(t,i,n.glyph,n.fullname,1,!1,5,2,void 0,void 0,!1,n);return o.item.glyph=e.glyph,o}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(10);function n(e){let t=e.reduce((e,t)=>e+t,0),i=s.randint(0,t),n=0,o=0;for(const t of e){if(i<=(n+=t))return o;o+=1}return 0}t.from_dungeon_level=function(e,t){for(let i=e.length-1;i>-1;i--)if(t>=e[i][1])return e[i][0];return 0},t.random_choice_index=n,t.random_choice_from_dict=function(e){let t=[],i=[];for(let s in e)i.push(s),t.push(e[s]);return i[n(t)]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4);t.Fighter=class{constructor(e,t,i,s){this.hp=e,this.base_max_hp=e,this.base_defense=t,this.base_power=i,this.xp=s,this.status="normal",this.current_exp=0,this.nextRank=50,this.unspentPoints=0,this.rank=1}power(){let e=0;return null!=this.owner&&(null!=this.owner.equipment&&(e+=this.owner.equipment.power_bonus),null!=this.owner.subequipment&&(e+=this.owner.subequipment.power_bonus)),this.base_power+e<0?0:this.base_power+e}skill_power(){let e=1;return null!=this.owner.ai?this.power()*this.owner.ai.skill_bonus:(null!=this.owner.equipment&&(e+=this.owner.equipment.skill_bonus),null!=this.owner.subequipment&&(e+=this.owner.equipment.skill_bonus),(this.power()<1?1:this.power())*e)}defense(){let e=0;return null!=this.owner&&(null!=this.owner.equipment&&(e+=this.owner.equipment.defense_bonus),null!=this.owner.subequipment&&(e+=this.owner.equipment.defense_bonus)),this.base_defense+e<0?0:this.base_defense+e}max_hp(){let e=0;return null!=this.owner&&(null!=this.owner.equipment&&(e+=this.owner.equipment.hp_bonus),null!=this.owner.subequipment&&(e+=this.owner.subequipment.hp_bonus)),this.base_max_hp+e}takeDamage(e,t){if(1==this.owner.player&&null!=this.owner.subequipment&&(e=this.owner.subequipment.defend(e)),this.hp-=e,this.hp<=0)return this.hp=0,1==this.owner.player&&(this.owner.lastxp=this.current_exp,this.owner.killedby=t),this.owner._map.messageLog.newMessage(this.owner,"death",this.owner,void 0),s.deathFunction(this.owner),!0}heal(e){this.hp+=e,this.hp>this.max_hp()&&(this.hp=this.max_hp())}attack(e){let t={message:"",type:"fight",color0:e.glyph.foreground,color1:[255,255,255],color2:[255,255,255]},i=this.power()*(1-e.fighter.defense()/(10+e.fighter.defense()));return(i=+i.toFixed(2))>0?(e.fighter.takeDamage(i,this.owner.name)&&this.getExp(e.fighter.xp),this.owner._map.messageLog.newMessage(this.owner,"fight",e,void 0,i.toString())):this.owner._map.messageLog.newMessage(this.owner,"fightZeroDamage",e,void 0,i.toString()),t}equipment_skill(e,t){let i=t.damage.multiplier,s={message:"",type:"skill",color0:e.glyph.foreground,color1:[255,255,255],color2:[255,255,255]},n=0;return(n=+(n=null!=this.owner.ai?this.power()*i*(1-e.fighter.defense()/(7+e.fighter.defense())):this.skill_power()*(1-e.fighter.defense()/(7+e.fighter.defense()))).toFixed(2))>0?(e.fighter.takeDamage(n,this.owner.name)&&this.getExp(e.fighter.xp),this.owner._map.messageLog.newMessage(this.owner,"skill",e,t,n.toString())):this.owner._map.messageLog.newMessage(this.owner,"skillZeroDamage",e,t,n.toString()),s}getExp(e){for(this.current_exp+=e;this.current_exp>=this.nextRank;)this.rank+=1,this.nextRank+=(this.nextRank+60)/2.9,this.unspentPoints+=1}}},function(e,t,i){"use strict";i.r(t);var s={};i.r(s),i.d(s,"TYPE_TEXT",function(){return d}),i.d(s,"TYPE_NEWLINE",function(){return m}),i.d(s,"TYPE_FG",function(){return p}),i.d(s,"TYPE_BG",function(){return g}),i.d(s,"measure",function(){return f}),i.d(s,"tokenize",function(){return w});var n=i(0),o=i(14);class r extends o.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(e){requestAnimationFrame(e)}getContainer(){return this._ctx.canvas}setOptions(e){super.setOptions(e);const t=`${e.fontStyle?`${e.fontStyle} `:""} ${e.fontSize}px ${e.fontFamily}`;this._ctx.font=t,this._updateSize(),this._ctx.font=t,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(e,t){let i=this._ctx.canvas,s=i.getBoundingClientRect();return e-=s.left,t-=s.top,e*=i.width/s.width,t*=i.height/s.height,e<0||t<0||e>=i.width||t>=i.height?[-1,-1]:this._normalizedEventToPosition(e,t)}}var a=i(9);class h extends r{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(e,t){let[i,s,n,o,r]=e,a=[(i+1)*this._spacingX,s*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),t&&(this._ctx.fillStyle=r,this._fill(a[0],a[1])),!n)return;this._ctx.fillStyle=o;let h=[].concat(n);for(let e=0;e<h.length;e++)this._ctx.fillText(h[e],a[0],Math.ceil(a[1]))}computeSize(e,t){return this._options.transpose&&(e+=t,e-=t=e-t),[Math.floor(e/this._spacingX)-1,Math.floor((t-2*this._hexSize)/this._spacingY+1)]}computeFontSize(e,t){this._options.transpose&&(e+=t,e-=t=e-t);let i=2*e/((this._options.width+1)*Math.sqrt(3))-1,s=t/(2+1.5*(this._options.height-1)),n=Math.min(i,s),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let r=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let a=r/100,h=2*(n=Math.floor(n)+1)/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(h)-1}_normalizedEventToPosition(e,t){let i;this._options.transpose?(e+=t,e-=t=e-t,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let s=i/this._options.height;return t=Math.floor(t/s),Object(a.mod)(t,2)?(e-=this._spacingX,e=1+2*Math.floor(e/(2*this._spacingX))):e=2*Math.floor(e/(2*this._spacingX)),[e,t]}_fill(e,t){let i=this._hexSize,s=this._options.border;const n=this._ctx;n.beginPath(),this._options.transpose?(n.moveTo(e-i+s,t),n.lineTo(e-i/2+s,t+this._spacingX-s),n.lineTo(e+i/2-s,t+this._spacingX-s),n.lineTo(e+i-s,t),n.lineTo(e+i/2-s,t-this._spacingX+s),n.lineTo(e-i/2+s,t-this._spacingX+s),n.lineTo(e-i+s,t)):(n.moveTo(e,t-i+s),n.lineTo(e+this._spacingX-s,t-i/2+s),n.lineTo(e+this._spacingX-s,t+i/2-s),n.lineTo(e,t+i-s),n.lineTo(e-this._spacingX+s,t+i/2-s),n.lineTo(e-this._spacingX+s,t-i/2+s),n.lineTo(e,t-i+s)),n.fill()}_updateSize(){const e=this._options,t=Math.ceil(this._ctx.measureText("W").width);let i,s;this._hexSize=Math.floor(e.spacing*(e.fontSize+t/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,e.transpose?(i="height",s="width"):(i="width",s="height"),this._ctx.canvas[i]=Math.ceil((e.width+1)*this._spacingX),this._ctx.canvas[s]=Math.ceil((e.height-1)*this._spacingY+2*this._hexSize)}}class l extends r{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(e){super.setOptions(e),this._canvasCache={}}draw(e,t){l.cache?this._drawWithCache(e):this._drawNoCache(e,t)}_drawWithCache(e){let t,[i,s,n,o,r]=e,a=""+n+o+r;if(a in this._canvasCache)t=this._canvasCache[a];else{let e=this._options.border,i=(t=document.createElement("canvas")).getContext("2d");if(t.width=this._spacingX,t.height=this._spacingY,i.fillStyle=r,i.fillRect(e,e,t.width-e,t.height-e),n){i.fillStyle=o,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let e=[].concat(n);for(let t=0;t<e.length;t++)i.fillText(e[t],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=t}this._ctx.drawImage(t,i*this._spacingX,s*this._spacingY)}_drawNoCache(e,t){let[i,s,n,o,r]=e;if(t){let e=this._options.border;this._ctx.fillStyle=r,this._ctx.fillRect(i*this._spacingX+e,s*this._spacingY+e,this._spacingX-e,this._spacingY-e)}if(!n)return;this._ctx.fillStyle=o;let a=[].concat(n);for(let e=0;e<a.length;e++)this._ctx.fillText(a[e],(i+.5)*this._spacingX,Math.ceil((s+.5)*this._spacingY))}computeSize(e,t){return[Math.floor(e/this._spacingX),Math.floor(t/this._spacingY)]}computeFontSize(e,t){let i=Math.floor(e/this._options.width),s=Math.floor(t/this._options.height),n=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=n;let r=o/100*s/i;return r>1&&(s=Math.floor(s/r)),Math.floor(s/this._options.spacing)}_normalizedEventToPosition(e,t){return[Math.floor(e/this._spacingX),Math.floor(t/this._spacingY)]}_updateSize(){const e=this._options,t=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(e.spacing*t),this._spacingY=Math.ceil(e.spacing*e.fontSize),e.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=e.width*this._spacingX,this._ctx.canvas.height=e.height*this._spacingY}}l.cache=!1;class c extends r{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(e,t){let[i,s,n,o,r]=e,a=this._options.tileWidth,h=this._options.tileHeight;if(t&&(this._options.tileColorize?this._ctx.clearRect(i*a,s*h,a,h):(this._ctx.fillStyle=r,this._ctx.fillRect(i*a,s*h,a,h))),!n)return;let l=[].concat(n),c=[].concat(o),u=[].concat(r);for(let e=0;e<l.length;e++){let t=this._options.tileMap[l[e]];if(!t)throw new Error(`Char "${l[e]}" not found in tileMap`);if(this._options.tileColorize){let n=this._colorCanvas,o=n.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,a,h);let r=c[e],l=u[e];o.drawImage(this._options.tileSet,t[0],t[1],a,h,0,0,a,h),"transparent"!=r&&(o.fillStyle=r,o.globalCompositeOperation="source-atop",o.fillRect(0,0,a,h)),"transparent"!=l&&(o.fillStyle=l,o.globalCompositeOperation="destination-over",o.fillRect(0,0,a,h)),this._ctx.drawImage(n,i*a,s*h,a,h)}else this._ctx.drawImage(this._options.tileSet,t[0],t[1],a,h,i*a,s*h,a,h)}}computeSize(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}_updateSize(){const e=this._options;this._ctx.canvas.width=e.width*e.tileWidth,this._ctx.canvas.height=e.height*e.tileHeight,this._colorCanvas.width=e.tileWidth,this._colorCanvas.height=e.tileHeight}}var u=i(20);const _=/%([bc]){([^}]*)}/g,d=0,m=1,p=2,g=3;function f(e,t){let i={width:0,height:1},s=w(e,t),n=0;for(let e=0;e<s.length;e++){let t=s[e];switch(t.type){case d:n+=t.value.length;break;case m:i.height++,i.width=Math.max(i.width,n),n=0}}return i.width=Math.max(i.width,n),i}function w(e,t){let i=[],s=0;e.replace(_,function(t,n,o,r){let a=e.substring(s,r);return a.length&&i.push({type:d,value:a}),i.push({type:"c"==n?p:g,value:o.trim()}),s=r+t.length,""});let n=e.substring(s);return n.length&&i.push({type:d,value:n}),function(e,t){t||(t=1/0);let i=0,s=0,n=-1;for(;i<e.length;){let o=e[i];if(o.type==m&&(s=0,n=-1),o.type!=d){i++;continue}for(;0==s&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let r=o.value.indexOf("\n");if(-1!=r){o.value=y(e,i,r,!0);let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}if(o.value.length){if(s+o.value.length>t){let r=-1;for(;;){let e=o.value.indexOf(" ",r+1);if(-1==e)break;if(s+e>t)break;r=e}if(-1!=r)o.value=y(e,i,r,!0);else if(-1!=n){let t=e[n],s=t.value.lastIndexOf(" ");t.value=y(e,n,s,!0),i=n}else o.value=y(e,i,t-s,!1)}else s+=o.value.length,-1!=o.value.indexOf(" ")&&(n=i);i++}else e.splice(i,1)}e.push({type:m});let o=null;for(let t=0;t<e.length;t++){let i=e[t];switch(i.type){case d:o=i;break;case m:if(o){let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}o=null}}return e.pop(),e}(i,t)}function y(e,t,i,s){let n={type:m},o={type:d,value:e[t].value.substring(i+(s?1:0))};return e.splice(t+1,0,n,o),e[t].value.substring(0,i)}var x=i(1);const b={hex:h,rect:l,tile:c,term:u.a},k={width:x.DEFAULT_WIDTH,height:x.DEFAULT_HEIGHT,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class v{constructor(e={}){this._data={},this._dirty=!1,this._options={},e=Object.assign({},k,e),this.setOptions(e),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(e,t,i){let s=[this._options.bg,this._options.fg];this.draw(e,t,null,null,s[i%s.length])}clear(){this._data={},this._dirty=!0}setOptions(e){if(Object.assign(this._options,e),e.width||e.height||e.fontSize||e.fontFamily||e.spacing||e.layout){if(e.layout){let t=b[e.layout];this._backend=new t}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(e,t){return this._backend.computeSize(e,t)}computeFontSize(e,t){return this._backend.computeFontSize(e,t)}computeTileSize(e,t){return[Math.floor(e/this._options.width),Math.floor(t/this._options.height)]}eventToPosition(e){let t,i;return"touches"in e?(t=e.touches[0].clientX,i=e.touches[0].clientY):(t=e.clientX,i=e.clientY),this._backend.eventToPosition(t,i)}draw(e,t,i,s,n){s||(s=this._options.fg),n||(n=this._options.bg);let o=`${e},${t}`;this._data[o]=[e,t,i,s,n],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawText(e,t,i,s){let n=null,o=null,r=e,a=t,h=1;s||(s=this._options.width-e);let l=w(i,s);for(;l.length;){let t=l.shift();switch(t.type){case d:let i=!1,s=!1,l=!1,c=!1;for(let e=0;e<t.value.length;e++){let h=t.value.charCodeAt(e),u=t.value.charAt(e);l=h>65280&&h<65377||h>65500&&h<65512||h>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!c||l||i||r++,l&&!s&&r++,this.draw(r++,a,u,n,o),s=i,c=l}break;case p:n=t.value||null;break;case g:o=t.value||null;break;case m:r=e,a++,h++}}return h}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let e in this._data)this._draw(e,!1)}else for(let e in this._dirty)this._draw(e,!0);this._dirty=!1}}_draw(e,t){let i=this._data[e];i[4]!=this._options.bg&&(t=!0),this._backend.draw(i,t)}}v.Rect=l,v.Hex=h,v.Tile=c,v.Term=u.a;class D{constructor(e){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,e),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let e=0;e<this._options.order;e++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let e=[this._sample(this._prefix)];for(;e[e.length-1]!=this._boundary;)e.push(this._sample(e));return this._join(e.slice(0,-1))}observe(e){let t=this._split(e);for(let e=0;e<t.length;e++)this._priorValues[t[e]]=this._options.prior;t=this._prefix.concat(t).concat(this._suffix);for(let e=this._options.order;e<t.length;e++){let i=t.slice(e-this._options.order,e),s=t[e];for(let e=0;e<i.length;e++){let t=i.slice(e);this._observeEvent(t,s)}}}getStats(){let e=[],t=Object.keys(this._priorValues).length;t--,e.push("distinct samples: "+t);let i=Object.keys(this._data).length,s=0;for(let e in this._data)s+=Object.keys(this._data[e]).length;return e.push("dictionary size (contexts): "+i),e.push("dictionary size (events): "+s),e.join(", ")}_split(e){return e.split(this._options.words?/\s+/:"")}_join(e){return e.join(this._options.words?" ":"")}_observeEvent(e,t){let i=this._join(e);i in this._data||(this._data[i]={});let s=this._data[i];t in s||(s[t]=0),s[t]++}_sample(e){e=this._backoff(e);let t=this._join(e),i=this._data[t],s={};if(this._options.prior){for(let e in this._priorValues)s[e]=this._priorValues[e];for(let e in i)s[e]+=i[e]}else s=i;return n.a.getWeightedValue(s)}_backoff(e){for(e.length>this._options.order?e=e.slice(-this._options.order):e.length<this._options.order&&(e=this._prefix.slice(0,this._options.order-e.length).concat(e));!(this._join(e)in this._data)&&e.length>0;)e=e.slice(1);return e}}class B{constructor(){this._time=0,this._events=[],this._eventTimes=[]}getTime(){return this._time}clear(){return this._events=[],this._eventTimes=[],this}add(e,t){let i=this._events.length;for(let e=0;e<this._eventTimes.length;e++)if(this._eventTimes[e]>t){i=e;break}this._events.splice(i,0,e),this._eventTimes.splice(i,0,t)}get(){if(!this._events.length)return null;let e=this._eventTimes.splice(0,1)[0];if(e>0){this._time+=e;for(let t=0;t<this._eventTimes.length;t++)this._eventTimes[t]-=e}return this._events.splice(0,1)[0]}getEventTime(e){let t=this._events.indexOf(e);if(-1!=t)return this._eventTimes[t]}remove(e){let t=this._events.indexOf(e);return-1!=t&&(this._remove(t),!0)}_remove(e){this._events.splice(e,1),this._eventTimes.splice(e,1)}}class M{constructor(){this._queue=new B,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(e,t){return t&&this._repeat.push(e),this}getTimeOf(e){return this._queue.getEventTime(e)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(e){let t=this._queue.remove(e),i=this._repeat.indexOf(e);return-1!=i&&this._repeat.splice(i,1),this._current==e&&(this._current=null),t}next(){return this._current=this._queue.get(),this._current}}var S={Simple:class extends M{add(e,t){return this._queue.add(e,0),super.add(e,t)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends M{add(e,t,i){return this._queue.add(e,void 0!==i?i:1/e.getSpeed()),super.add(e,t)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends M{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(e,t,i){return this._queue.add(e,i||this._defaultDuration),super.add(e,t)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(e){return e==this._current&&(this._duration=this._defaultDuration),super.remove(e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(e){return this._current&&(this._duration=e),this}}};class T{constructor(e,t={}){this._lightPasses=e,this._options=Object.assign({topology:8},t)}_getCircle(e,t,i){let s,n,o,r=[];switch(this._options.topology){case 4:n=1,o=[0,1],s=[x.DIRS[8][7],x.DIRS[8][1],x.DIRS[8][3],x.DIRS[8][5]];break;case 6:s=x.DIRS[6],n=1,o=[-1,1];break;case 8:s=x.DIRS[4],n=2,o=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let a=e+o[0]*i,h=t+o[1]*i;for(let e=0;e<s.length;e++)for(let t=0;t<i*n;t++)r.push([a,h]),a+=s[e][0],h+=s[e][1];return r}}const C=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];var E={DiscreteShadowcasting:class extends T{compute(e,t,i,s){if(s(e,t,0,1),!this._lightPasses(e,t))return;let n,o,r,a,h,l=[];for(let c=1;c<=i;c++){let i=this._getCircle(e,t,c),u=360/i.length;for(let e=0;e<i.length;e++)if(r=i[e][0],a=i[e][1],o=(n=u*(e-.5))+u,h=!this._lightPasses(r,a),this._visibleCoords(Math.floor(n),Math.ceil(o),h,l)&&s(r,a,c,1),2==l.length&&0==l[0]&&360==l[1])return}}_visibleCoords(e,t,i,s){if(e<0){let n=this._visibleCoords(0,t,i,s),o=this._visibleCoords(360+e,360,i,s);return n||o}let n=0;for(;n<s.length&&s[n]<e;)n++;if(n==s.length)return i&&s.push(e,t),!0;let o=0;if(n%2){for(;n<s.length&&s[n]<t;)n++,o++;return 0!=o&&(i&&(o%2?s.splice(n-o,o,t):s.splice(n-o,o)),!0)}for(;n<s.length&&s[n]<t;)n++,o++;return(e!=s[n-o]||1!=o)&&(i&&(o%2?s.splice(n-o,o,e):s.splice(n-o,o,e,t)),!0)}},PreciseShadowcasting:class extends T{compute(e,t,i,s){if(s(e,t,0,1),!this._lightPasses(e,t))return;let n,o,r,a,h,l,c=[];for(let u=1;u<=i;u++){let i=this._getCircle(e,t,u),_=i.length;for(let e=0;e<_;e++)if(n=i[e][0],o=i[e][1],a=[e?2*e-1:2*_-1,2*_],h=[2*e+1,2*_],r=!this._lightPasses(n,o),s(n,o,u,l=this._checkVisibility(a,h,r,c)),2==c.length&&0==c[0][0]&&c[1][0]==c[1][1])return}}_checkVisibility(e,t,i,s){if(e[0]>t[0])return(this._checkVisibility(e,[e[1],e[1]],i,s)+this._checkVisibility([0,1],t,i,s))/2;let n=0,o=!1;for(;n<s.length;){let t=s[n],i=t[0]*e[1]-e[0]*t[1];if(i>=0){0!=i||n%2||(o=!0);break}n++}let r=s.length,a=!1;for(;r--;){let e=s[r],i=t[0]*e[1]-e[0]*t[1];if(i>=0){0==i&&r%2&&(a=!0);break}}let h,l=!0;if(n==r&&(o||a)?l=!1:o&&a&&n+1==r&&r%2?l=!1:n>r&&n%2&&(l=!1),!l)return 0;let c=r-n+1;if(c%2)if(n%2){let e=s[n];h=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),i&&s.splice(n,c,t)}else{let t=s[r];h=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),i&&s.splice(n,c,e)}else{if(!(n%2))return i&&s.splice(n,c,e,t),1;{let e=s[n],t=s[r];h=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),i&&s.splice(n,c)}}return h/((t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]))}},RecursiveShadowcasting:class extends T{compute(e,t,i,s){s(e,t,0,1);for(let n=0;n<C.length;n++)this._renderOctant(e,t,C[n],i,s)}compute180(e,t,i,s,n){n(e,t,0,1);let o=(s-1+8)%8,r=(s-2+8)%8,a=(s+1+8)%8;this._renderOctant(e,t,C[r],i,n),this._renderOctant(e,t,C[o],i,n),this._renderOctant(e,t,C[s],i,n),this._renderOctant(e,t,C[a],i,n)}compute90(e,t,i,s,n){n(e,t,0,1);let o=(s-1+8)%8;this._renderOctant(e,t,C[s],i,n),this._renderOctant(e,t,C[o],i,n)}_renderOctant(e,t,i,s,n){this._castVisibility(e,t,1,1,0,s+1,i[0],i[1],i[2],i[3],n)}_castVisibility(e,t,i,s,n,o,r,a,h,l,c){if(!(s<n))for(let u=i;u<=o;u++){let i=-u-1,_=-u,d=!1,m=0;for(;i<=0;){let p=e+(i+=1)*r+_*a,g=t+i*h+_*l,f=(i-.5)/(_+.5),w=(i+.5)/(_-.5);if(!(w>s)){if(f<n)break;if(i*i+_*_<o*o&&c(p,g,u,1),d){if(!this._lightPasses(p,g)){m=w;continue}d=!1,s=m}else!this._lightPasses(p,g)&&u<o&&(d=!0,this._castVisibility(e,t,u+1,s,f,o,r,a,h,l,c),m=w)}}if(d)break}}}},K=i(19);class V{}const R=.5*(Math.sqrt(3)-1),P=(3-Math.sqrt(3))/6;var O={Simplex:class extends V{constructor(e=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let t=[];for(let i=0;i<e;i++)t.push(i);t=n.a.shuffle(t),this._perms=[],this._indexes=[];for(let i=0;i<2*e;i++)this._perms.push(t[i%e]),this._indexes.push(this._perms[i]%this._gradients.length)}get(e,t){let i,s,n,o=this._perms,r=this._indexes,h=o.length/2,l=0,c=0,u=0,_=(e+t)*R,d=Math.floor(e+_),m=Math.floor(t+_),p=(d+m)*P,g=e-(d-p),f=t-(m-p);g>f?(s=1,n=0):(s=0,n=1);let w=g-s+P,y=f-n+P,x=g-1+2*P,b=f-1+2*P,k=Object(a.mod)(d,h),v=Object(a.mod)(m,h),D=.5-g*g-f*f;if(D>=0){D*=D,i=r[k+o[v]];let e=this._gradients[i];l=D*D*(e[0]*g+e[1]*f)}let B=.5-w*w-y*y;if(B>=0){B*=B,i=r[k+s+o[v+n]];let e=this._gradients[i];c=B*B*(e[0]*w+e[1]*y)}let M=.5-x*x-b*b;if(M>=0){M*=M,i=r[k+1+o[v+1]];let e=this._gradients[i];u=M*M*(e[0]*x+e[1]*b)}return 70*(l+c+u)}}};class W{constructor(e,t,i,s={}){this._toX=e,this._toY=t,this._passableCallback=i,this._options=Object.assign({topology:8},s),this._dirs=x.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(e,t){let i=[];for(let s=0;s<this._dirs.length;s++){let n=this._dirs[s],o=e+n[0],r=t+n[1];this._passableCallback(o,r)&&i.push([o,r])}return i}}var q={Dijkstra:class extends W{constructor(e,t,i,s){super(e,t,i,s),this._computed={},this._todo=[],this._add(e,t,null)}compute(e,t,i){let s=e+","+t;if(s in this._computed||this._compute(e,t),!(s in this._computed))return;let n=this._computed[s];for(;n;)i(n.x,n.y),n=n.prev}_compute(e,t){for(;this._todo.length;){let i=this._todo.shift();if(i.x==e&&i.y==t)return;let s=this._getNeighbors(i.x,i.y);for(let e=0;e<s.length;e++){let t=s[e],n=t[0],o=t[1];n+","+o in this._computed||this._add(n,o,i)}}}_add(e,t,i){let s={x:e,y:t,prev:i};this._computed[e+","+t]=s,this._todo.push(s)}},AStar:class extends W{constructor(e,t,i,s={}){super(e,t,i,s),this._todo=[],this._done={}}compute(e,t,i){for(this._todo=[],this._done={},this._fromX=e,this._fromY=t,this._add(this._toX,this._toY,null);this._todo.length;){let i=this._todo.shift(),s=i.x+","+i.y;if(s in this._done)continue;if(this._done[s]=i,i.x==e&&i.y==t)break;let n=this._getNeighbors(i.x,i.y);for(let e=0;e<n.length;e++){let t=n[e],s=t[0],o=t[1];s+","+o in this._done||this._add(s,o,i)}}let s=this._done[e+","+t];if(s)for(;s;)i(s.x,s.y),s=s.prev}_add(e,t,i){let s=this._distance(e,t),n={x:e,y:t,prev:i,g:i?i.g+1:0,h:s},o=n.g+n.h;for(let e=0;e<this._todo.length;e++){let t=this._todo[e],i=t.g+t.h;if(o<i||o==i&&s<t.h)return void this._todo.splice(e,0,n)}this._todo.push(n)}_distance(e,t){switch(this._options.topology){case 4:return Math.abs(e-this._fromX)+Math.abs(t-this._fromY);case 6:let i=Math.abs(e-this._fromX),s=Math.abs(t-this._fromY);return s+Math.max(0,(i-s)/2);case 8:return Math.max(Math.abs(e-this._fromX),Math.abs(t-this._fromY))}}}};class I{constructor(e){this._scheduler=e,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let e=this._scheduler.next();if(!e)return this.lock();let t=e.act();t&&t.then&&(this.lock(),t.then(this.unlock.bind(this)))}return this}}var A=i(12);class F{constructor(e,t={}){this._reflectivityCallback=e,this._options={},t=Object.assign({passes:1,emissionThreshold:100,range:10},t),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(t)}setOptions(e){return Object.assign(this._options,e),e&&e.range&&this.reset(),this}setFOV(e){return this._fov=e,this._fovCache={},this}setLight(e,t,i){let s=e+","+t;return i?this._lights[s]="string"==typeof i?A.fromString(i):i:delete this._lights[s],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(e){let t={},i={},s={};for(let e in this._lights){let t=this._lights[e];i[e]=[0,0,0],A.add_(i[e],t)}for(let e=0;e<this._options.passes;e++)this._emitLight(i,s,t),e+1!=this._options.passes&&(i=this._computeEmitters(s,t));for(let t in s){let i=t.split(",");e(parseInt(i[0]),parseInt(i[1]),s[t])}return this}_emitLight(e,t,i){for(let s in e){let n=s.split(","),o=parseInt(n[0]),r=parseInt(n[1]);this._emitLightFromCell(o,r,e[s],t),i[s]=1}return this}_computeEmitters(e,t){let i={};for(let s in e){if(s in t)continue;let n,o=e[s];if(s in this._reflectivityCache)n=this._reflectivityCache[s];else{let e=s.split(","),t=parseInt(e[0]),i=parseInt(e[1]);n=this._reflectivityCallback(t,i),this._reflectivityCache[s]=n}if(0==n)continue;let r=[0,0,0],a=0;for(let e=0;e<3;e++){let t=Math.round(o[e]*n);r[e]=t,a+=t}a>this._options.emissionThreshold&&(i[s]=r)}return i}_emitLightFromCell(e,t,i,s){let n,o=e+","+t;n=o in this._fovCache?this._fovCache[o]:this._updateFOV(e,t);for(let e in n){let t,o=n[e];e in s?t=s[e]:(t=[0,0,0],s[e]=t);for(let e=0;e<3;e++)t[e]+=Math.round(i[e]*o)}return this}_updateFOV(e,t){let i=e+","+t,s={};this._fovCache[i]=s;let n=this._options.range;return this._fov.compute(e,t,n,function(e,t,i,o){let r=o*(1-i/n);0!=r&&(s[e+","+t]=r)}.bind(this)),s}}i.d(t,"Util",function(){return L}),i.d(t,"Color",function(){return X}),i.d(t,"Text",function(){return U}),i.d(t,"RNG",function(){return n.a}),i.d(t,"Display",function(){return v}),i.d(t,"StringGenerator",function(){return D}),i.d(t,"EventQueue",function(){return B}),i.d(t,"Scheduler",function(){return S}),i.d(t,"FOV",function(){return E}),i.d(t,"Map",function(){return K.default}),i.d(t,"Noise",function(){return O}),i.d(t,"Path",function(){return q}),i.d(t,"Engine",function(){return I}),i.d(t,"Lighting",function(){return F}),i.d(t,"DEFAULT_WIDTH",function(){return x.DEFAULT_WIDTH}),i.d(t,"DEFAULT_HEIGHT",function(){return x.DEFAULT_HEIGHT}),i.d(t,"DIRS",function(){return x.DIRS}),i.d(t,"KEYS",function(){return x.KEYS});const L=a,X=A,U=s},function(e,t,i){"use strict";i.r(t);var s=i(1);class n{constructor(e=s.DEFAULT_WIDTH,t=s.DEFAULT_HEIGHT){this._width=e,this._height=t}_fillMap(e){let t=[];for(let i=0;i<this._width;i++){t.push([]);for(let s=0;s<this._height;s++)t[i].push(e)}return t}}class o extends n{constructor(e,t){super(e,t),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}var r=i(0);class a{}class h extends a{constructor(e,t,i,s,n,o){super(),this._x1=e,this._y1=t,this._x2=i,this._y2=s,this._doors={},void 0!==n&&void 0!==o&&this.addDoor(n,o)}static createRandomAt(e,t,i,s,n){let o=n.roomWidth[0],a=n.roomWidth[1],h=r.a.getUniformInt(o,a);o=n.roomHeight[0],a=n.roomHeight[1];let l=r.a.getUniformInt(o,a);if(1==i){let i=t-Math.floor(r.a.getUniform()*l);return new this(e+1,i,e+h,i+l-1,e,t)}if(-1==i){let i=t-Math.floor(r.a.getUniform()*l);return new this(e-h,i,e-1,i+l-1,e,t)}if(1==s){let i=e-Math.floor(r.a.getUniform()*h);return new this(i,t+1,i+h-1,t+l,e,t)}if(-1==s){let i=e-Math.floor(r.a.getUniform()*h);return new this(i,t-l,i+h-1,t-1,e,t)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(e,t,i){let s=i.roomWidth[0],n=i.roomWidth[1],o=r.a.getUniformInt(s,n);s=i.roomHeight[0],n=i.roomHeight[1];let a=r.a.getUniformInt(s,n),h=e-Math.floor(r.a.getUniform()*o),l=t-Math.floor(r.a.getUniform()*a);return new this(h,l,h+o-1,l+a-1)}static createRandom(e,t,i){let s=i.roomWidth[0],n=i.roomWidth[1],o=r.a.getUniformInt(s,n);s=i.roomHeight[0],n=i.roomHeight[1];let a=r.a.getUniformInt(s,n),h=e-o-1,l=t-a-1,c=1+Math.floor(r.a.getUniform()*h),u=1+Math.floor(r.a.getUniform()*l);return new this(c,u,c+o-1,u+a-1)}addDoor(e,t){return this._doors[e+","+t]=1,this}getDoors(e){for(let t in this._doors){let i=t.split(",");e(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(e){let t=this._x1-1,i=this._x2+1,s=this._y1-1,n=this._y2+1;for(let o=t;o<=i;o++)for(let r=s;r<=n;r++)o!=t&&o!=i&&r!=s&&r!=n||e(o,r)||this.addDoor(o,r);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(e,t){let i=this._x1-1,s=this._x2+1,n=this._y1-1,o=this._y2+1;for(let r=i;r<=s;r++)for(let a=n;a<=o;a++)if(r==i||r==s||a==n||a==o){if(!e(r,a))return!1}else if(!t(r,a))return!1;return!0}create(e){let t=this._x1-1,i=this._x2+1,s=this._y1-1,n=this._y2+1,o=0;for(let r=t;r<=i;r++)for(let a=s;a<=n;a++)e(r,a,o=r+","+a in this._doors?2:r==t||r==i||a==s||a==n?1:0)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class l extends a{constructor(e,t,i,s){super(),this._startX=e,this._startY=t,this._endX=i,this._endY=s,this._endsWithAWall=!0}static createRandomAt(e,t,i,s,n){let o=n.corridorLength[0],a=n.corridorLength[1],h=r.a.getUniformInt(o,a);return new this(e,t,e+i*h,t+s*h)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(e,t){let i=this._startX,s=this._startY,n=this._endX-i,o=this._endY-s,r=1+Math.max(Math.abs(n),Math.abs(o));n&&(n/=Math.abs(n)),o&&(o/=Math.abs(o));let a=o,h=-n,l=!0;for(let c=0;c<r;c++){let u=i+c*n,_=s+c*o;if(t(u,_)||(l=!1),e(u+a,_+h)||(l=!1),e(u-a,_-h)||(l=!1),!l){r=c,this._endX=u-n,this._endY=_-o;break}}if(0==r)return!1;if(1==r&&e(this._endX+n,this._endY+o))return!1;let c=!e(this._endX+n+a,this._endY+o+h),u=!e(this._endX+n-a,this._endY+o-h);return this._endsWithAWall=e(this._endX+n,this._endY+o),!c&&!u||!this._endsWithAWall}create(e){let t=this._startX,i=this._startY,s=this._endX-t,n=this._endY-i,o=1+Math.max(Math.abs(s),Math.abs(n));s&&(s/=Math.abs(s)),n&&(n/=Math.abs(n));for(let r=0;r<o;r++){e(t+r*s,i+r*n,0)}return!0}createPriorityWalls(e){if(!this._endsWithAWall)return;let t=this._startX,i=this._startY,s=this._endX-t,n=this._endY-i;s&&(s/=Math.abs(s)),n&&(n/=Math.abs(n));let o=n,r=-s;e(this._endX+s,this._endY+n),e(this._endX+o,this._endY+r),e(this._endX-o,this._endY-r)}}const c={room:h,corridor:l};function u(e,t,i){i[t[e+1]]=i[e],t[i[e]]=t[e+1],i[e]=e+1,t[e+1]=e}function _(e,t,i){i[t[e]]=i[e],t[i[e]]=t[e],i[e]=e,t[e]=e}t.default={Arena:class extends n{create(e){let t=this._width-1,i=this._height-1;for(let s=0;s<=t;s++)for(let n=0;n<=i;n++)e(s,n,s&&n&&s<t&&n<i?0:1);return this}},Uniform:class extends o{constructor(e,t,i){super(e,t),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(e){let t=Date.now();for(;;){if(Date.now()-t>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(e)for(let t=0;t<this._width;t++)for(let i=0;i<this._height;i++)e(t,i,this._map[t][i]);return this}_generateRooms(){let e,t=this._width-2,i=this._height-2;do{if(e=this._generateRoom(),this._dug/(t*i)>this._options.roomDugPercentage)break}while(e)}_generateRoom(){let e=0;for(;e<this._roomAttempts;){e++;let t=h.createRandom(this._width,this._height,this._options);if(t.isValid(this._isWallCallback,this._canBeDugCallback))return t.create(this._digCallback),this._rooms.push(t),t}return null}_generateCorridors(){let e=0;for(;e<this._corridorAttempts;){e++,this._corridors=[],this._map=this._fillMap(1);for(let e=0;e<this._rooms.length;e++){let t=this._rooms[e];t.clearDoors(),t.create(this._digCallback)}for(this._unconnected=r.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let e=r.a.getItem(this._connected);if(!e)break;let t=this._closestRoom(this._unconnected,e);if(!t)break;let i=this._closestRoom(this._connected,t);if(!i)break;if(!this._connectRooms(t,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(e,t){let i=1/0,s=t.getCenter(),n=null;for(let t=0;t<e.length;t++){let o=e[t],r=o.getCenter(),a=r[0]-s[0],h=r[1]-s[1],l=a*a+h*h;l<i&&(i=l,n=o)}return n}_connectRooms(e,t){let i,s,n,o,r,a,h,l=e.getCenter(),c=t.getCenter(),u=c[0]-l[0],_=c[1]-l[1];if(Math.abs(u)<Math.abs(_)?(o=(2+(n=_>0?2:0))%4,r=t.getLeft(),a=t.getRight(),h=0):(o=(2+(n=u>0?1:3))%4,r=t.getTop(),a=t.getBottom(),h=1),!(i=this._placeInWall(e,n)))return!1;if(i[h]>=r&&i[h]<=a){s=i.slice();let e=0;switch(o){case 0:e=t.getTop()-1;break;case 1:e=t.getRight()+1;break;case 2:e=t.getBottom()+1;break;case 3:e=t.getLeft()-1}s[(h+1)%2]=e,this._digLine([i,s])}else if(i[h]<r-1||i[h]>a+1){let e=i[h]-c[h],n=0;switch(o){case 0:case 1:n=e<0?3:1;break;case 2:case 3:n=e<0?1:3}if(o=(o+n)%4,!(s=this._placeInWall(t,o)))return!1;let r=[0,0];r[h]=i[h];let a=(h+1)%2;r[a]=s[a],this._digLine([i,r,s])}else{let e=(h+1)%2;if(!(s=this._placeInWall(t,o)))return!1;let n=Math.round((s[e]+i[e])/2),r=[0,0],a=[0,0];r[h]=i[h],r[e]=n,a[h]=s[h],a[e]=n,this._digLine([i,r,a,s])}return e.addDoor(i[0],i[1]),t.addDoor(s[0],s[1]),-1!=(h=this._unconnected.indexOf(e))&&(this._unconnected.splice(h,1),this._connected.push(e)),-1!=(h=this._unconnected.indexOf(t))&&(this._unconnected.splice(h,1),this._connected.push(t)),!0}_placeInWall(e,t){let i=[0,0],s=[0,0],n=0;switch(t){case 0:s=[1,0],i=[e.getLeft(),e.getTop()-1],n=e.getRight()-e.getLeft()+1;break;case 1:s=[0,1],i=[e.getRight()+1,e.getTop()],n=e.getBottom()-e.getTop()+1;break;case 2:s=[1,0],i=[e.getLeft(),e.getBottom()+1],n=e.getRight()-e.getLeft()+1;break;case 3:s=[0,1],i=[e.getLeft()-1,e.getTop()],n=e.getBottom()-e.getTop()+1}let o=[],a=-2;for(let e=0;e<n;e++){let t=i[0]+e*s[0],n=i[1]+e*s[1];o.push(null),1==this._map[t][n]?a!=e-1&&(o[e]=[t,n]):(a=e,e&&(o[e-1]=null))}for(let e=o.length-1;e>=0;e--)o[e]||o.splice(e,1);return o.length?r.a.getItem(o):null}_digLine(e){for(let t=1;t<e.length;t++){let i=e[t-1],s=e[t],n=new l(i[0],i[1],s[0],s[1]);n.create(this._digCallback),this._corridors.push(n)}}_digCallback(e,t,i){this._map[e][t]=i,0==i&&this._dug++}_isWallCallback(e,t){return!(e<0||t<0||e>=this._width||t>=this._height)&&1==this._map[e][t]}_canBeDugCallback(e,t){return!(e<1||t<1||e+1>=this._width||t+1>=this._height)&&1==this._map[e][t]}},Cellular:class extends n{constructor(e,t,i={}){super(e,t),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=s.DIRS[this._options.topology],this._map=this._fillMap(0)}randomize(e){for(let t=0;t<this._width;t++)for(let i=0;i<this._height;i++)this._map[t][i]=r.a.getUniform()<e?1:0;return this}setOptions(e){Object.assign(this._options,e)}set(e,t,i){this._map[e][t]=i}create(e){let t=this._fillMap(0),i=this._options.born,s=this._options.survive;for(let e=0;e<this._height;e++){let n=1,o=0;6==this._options.topology&&(n=2,o=e%2);for(let r=o;r<this._width;r+=n){let n=this._map[r][e],o=this._getNeighbors(r,e);n&&-1!=s.indexOf(o)?t[r][e]=1:n||-1==i.indexOf(o)||(t[r][e]=1)}}this._map=t,e&&this._serviceCallback(e)}_serviceCallback(e){for(let t=0;t<this._height;t++){let i=1,s=0;6==this._options.topology&&(i=2,s=t%2);for(let n=s;n<this._width;n+=i)e(n,t,this._map[n][t])}}_getNeighbors(e,t){let i=0;for(let s=0;s<this._dirs.length;s++){let n=this._dirs[s],o=e+n[0],r=t+n[1];o<0||o>=this._width||r<0||r>=this._height||(i+=1==this._map[o][r]?1:0)}return i}connect(e,t,i){t||(t=0);let s=[],n={},o=1,a=[0,0];6==this._options.topology&&(o=2,a=[0,1]);for(let e=0;e<this._height;e++)for(let i=a[e%2];i<this._width;i+=o)if(this._freeSpace(i,e,t)){let t=[i,e];n[this._pointKey(t)]=t,s.push([i,e])}let h=s[r.a.getUniformInt(0,s.length-1)],l=this._pointKey(h),c={};for(c[l]=h,delete n[l],this._findConnected(c,n,[h],!1,t);Object.keys(n).length>0;){let e=this._getFromTo(c,n),s=e[0],o=e[1],r={};r[this._pointKey(s)]=s,this._findConnected(r,n,[s],!0,t),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,o,s,c,n,t,i);for(let e in r){let i=r[e];this._map[i[0]][i[1]]=t,c[e]=i,delete n[e]}}e&&this._serviceCallback(e)}_getFromTo(e,t){let i,s=[0,0],n=[0,0],o=Object.keys(e),a=Object.keys(t);for(let h=0;h<5;h++){if(o.length<a.length){let i=o;n=e[i[r.a.getUniformInt(0,i.length-1)]],s=this._getClosest(n,t)}else{let i=a;s=t[i[r.a.getUniformInt(0,i.length-1)]],n=this._getClosest(s,e)}if((i=(s[0]-n[0])*(s[0]-n[0])+(s[1]-n[1])*(s[1]-n[1]))<64)break}return[s,n]}_getClosest(e,t){let i=null,s=null;for(let n in t){let o=t[n],r=(o[0]-e[0])*(o[0]-e[0])+(o[1]-e[1])*(o[1]-e[1]);(null==s||r<s)&&(s=r,i=o)}return i}_findConnected(e,t,i,s,n){for(;i.length>0;){let o,r=i.splice(0,1)[0];o=6==this._options.topology?[[r[0]+2,r[1]],[r[0]+1,r[1]-1],[r[0]-1,r[1]-1],[r[0]-2,r[1]],[r[0]-1,r[1]+1],[r[0]+1,r[1]+1]]:[[r[0]+1,r[1]],[r[0]-1,r[1]],[r[0],r[1]+1],[r[0],r[1]-1]];for(let r=0;r<o.length;r++){let a=this._pointKey(o[r]);null==e[a]&&this._freeSpace(o[r][0],o[r][1],n)&&(e[a]=o[r],s||delete t[a],i.push(o[r]))}}}_tunnelToConnected(e,t,i,s,n,o){let r,a;t[0]<e[0]?(r=t,a=e):(r=e,a=t);for(let e=r[0];e<=a[0];e++){this._map[e][r[1]]=n;let t=[e,r[1]],o=this._pointKey(t);i[o]=t,delete s[o]}o&&r[0]<a[0]&&o(r,[a[0],r[1]]);let h=a[0];t[1]<e[1]?(r=t,a=e):(r=e,a=t);for(let e=r[1];e<a[1];e++){this._map[h][e]=n;let t=[h,e],o=this._pointKey(t);i[o]=t,delete s[o]}o&&r[1]<a[1]&&o([a[0],r[1]],[a[0],a[1]])}_tunnelToConnected6(e,t,i,s,n,o){let r,a;t[0]<e[0]?(r=t,a=e):(r=e,a=t);let h=r[0],l=r[1];for(;h!=a[0]||l!=a[1];){let e=2;l<a[1]?(l++,e=1):l>a[1]&&(l--,e=1),h<a[0]?h+=e:h>a[0]?h-=e:a[1]%2?h-=e:h+=e,this._map[h][l]=n;let t=[h,l],o=this._pointKey(t);i[o]=t,delete s[o]}o&&o(t,e)}_freeSpace(e,t,i){return e>=0&&e<this._width&&t>=0&&t<this._height&&this._map[e][t]==i}_pointKey(e){return e[0]+"."+e[1]}},Digger:class extends o{constructor(e,t,i={}){super(e,t),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(e){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let t=(this._width-2)*(this._height-2);this._firstRoom();let i,s=Date.now();do{if(i=0,Date.now()-s>this._options.timeLimit)break;let e=this._findWall();if(!e)break;let t=e.split(","),n=parseInt(t[0]),o=parseInt(t[1]),r=this._getDiggingDirection(n,o);if(!r)continue;let a=0;do{if(a++,this._tryFeature(n,o,r[0],r[1])){this._removeSurroundingWalls(n,o),this._removeSurroundingWalls(n-r[0],o-r[1]);break}}while(a<this._featureAttempts);for(let e in this._walls)this._walls[e]>1&&i++}while(this._dug/t<this._options.dugPercentage||i);if(this._addDoors(),e)for(let t=0;t<this._width;t++)for(let i=0;i<this._height;i++)e(t,i,this._map[t][i]);return this._walls={},this._map=[],this}_digCallback(e,t,i){0==i||2==i?(this._map[e][t]=0,this._dug++):this._walls[e+","+t]=1}_isWallCallback(e,t){return!(e<0||t<0||e>=this._width||t>=this._height)&&1==this._map[e][t]}_canBeDugCallback(e,t){return!(e<1||t<1||e+1>=this._width||t+1>=this._height)&&1==this._map[e][t]}_priorityWallCallback(e,t){this._walls[e+","+t]=2}_firstRoom(){let e=Math.floor(this._width/2),t=Math.floor(this._height/2),i=h.createRandomCenter(e,t,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let e=[],t=[];for(let i in this._walls)2==this._walls[i]?t.push(i):e.push(i);let i=t.length?t:e;if(!i.length)return null;let s=r.a.getItem(i.sort());return delete this._walls[s],s}_tryFeature(e,t,i,s){let n=r.a.getWeightedValue(this._features),o=c[n].createRandomAt(e,t,i,s,this._options);return!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof h&&this._rooms.push(o),o instanceof l&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)}_removeSurroundingWalls(e,t){let i=s.DIRS[4];for(let s=0;s<i.length;s++){let n=i[s],o=e+n[0],r=t+n[1];delete this._walls[o+","+r],o=e+2*n[0],r=t+2*n[1],delete this._walls[o+","+r]}}_getDiggingDirection(e,t){if(e<=0||t<=0||e>=this._width-1||t>=this._height-1)return null;let i=null,n=s.DIRS[4];for(let s=0;s<n.length;s++){let o=n[s],r=e+o[0],a=t+o[1];if(!this._map[r][a]){if(i)return null;i=o}}return i?[-i[0],-i[1]]:null}_addDoors(){let e=this._map;function t(t,i){return 1==e[t][i]}for(let e=0;e<this._rooms.length;e++){let i=this._rooms[e];i.clearDoors(),i.addDoors(t)}}},EllerMaze:class extends n{create(e){let t,i=this._fillMap(1),s=Math.ceil((this._width-2)/2),n=[],o=[];for(let e=0;e<s;e++)n.push(e),o.push(e);for(n.push(s-1),t=1;t+3<this._height;t+=2)for(let e=0;e<s;e++){let s=2*e+1,a=t;i[s][a]=0,e!=n[e+1]&&r.a.getUniform()>.375&&(u(e,n,o),i[s+1][a]=0),e!=n[e]&&r.a.getUniform()>.375?_(e,n,o):i[s][a+1]=0}for(let e=0;e<s;e++){let s=2*e+1,a=t;i[s][a]=0,e!=n[e+1]&&(e==n[e]||r.a.getUniform()>.375)&&(u(e,n,o),i[s+1][a]=0),_(e,n,o)}for(let t=0;t<this._width;t++)for(let s=0;s<this._height;s++)e(t,s,i[t][s]);return this}},DividedMaze:class extends n{constructor(){super(...arguments),this._stack=[],this._map=[]}create(e){let t=this._width,i=this._height;this._map=[];for(let e=0;e<t;e++){this._map.push([]);for(let s=0;s<i;s++){let n=0==e||0==s||e+1==t||s+1==i;this._map[e].push(n?1:0)}}this._stack=[[1,1,t-2,i-2]],this._process();for(let s=0;s<t;s++)for(let t=0;t<i;t++)e(s,t,this._map[s][t]);return this._map=[],this}_process(){for(;this._stack.length;){let e=this._stack.shift();this._partitionRoom(e)}}_partitionRoom(e){let t=[],i=[];for(let i=e[0]+1;i<e[2];i++){let s=this._map[i][e[1]-1],n=this._map[i][e[3]+1];!s||!n||i%2||t.push(i)}for(let t=e[1]+1;t<e[3];t++){let s=this._map[e[0]-1][t],n=this._map[e[2]+1][t];!s||!n||t%2||i.push(t)}if(!t.length||!i.length)return;let s=r.a.getItem(t),n=r.a.getItem(i);this._map[s][n]=1;let o=[],a=[];o.push(a);for(let t=e[0];t<s;t++)this._map[t][n]=1,a.push([t,n]);a=[],o.push(a);for(let t=s+1;t<=e[2];t++)this._map[t][n]=1,a.push([t,n]);a=[],o.push(a);for(let t=e[1];t<n;t++)this._map[s][t]=1,a.push([s,t]);a=[],o.push(a);for(let t=n+1;t<=e[3];t++)this._map[s][t]=1,a.push([s,t]);let h=r.a.getItem(o);for(let e=0;e<o.length;e++){let t=o[e];if(t==h)continue;let i=r.a.getItem(t);this._map[i[0]][i[1]]=0}this._stack.push([e[0],e[1],s-1,n-1]),this._stack.push([s+1,e[1],e[2],n-1]),this._stack.push([e[0],n+1,s-1,e[3]]),this._stack.push([s+1,n+1,e[2],e[3]])}},IceyMaze:class extends n{constructor(e,t,i=0){super(e,t),this._regularity=i,this._map=[]}create(e){let t=this._width,i=this._height,s=this._fillMap(1);t-=t%2?1:2,i-=i%2?1:2;let n=0,o=0,a=0,h=0,l=0,c=!1,u=[[0,0],[0,0],[0,0],[0,0]];do{if(n=1+2*Math.floor(r.a.getUniform()*(t-1)/2),o=1+2*Math.floor(r.a.getUniform()*(i-1)/2),l||(s[n][o]=0),!s[n][o]){this._randomize(u);do{0==Math.floor(r.a.getUniform()*(this._regularity+1))&&this._randomize(u),c=!0;for(let e=0;e<4;e++)if(a=n+2*u[e][0],h=o+2*u[e][1],this._isFree(s,a,h,t,i)){s[a][h]=0,s[n+u[e][0]][o+u[e][1]]=0,n=a,o=h,c=!1,l++;break}}while(!c)}}while(l+1<t*i/4);for(let t=0;t<this._width;t++)for(let i=0;i<this._height;i++)e(t,i,s[t][i]);return this._map=[],this}_randomize(e){for(let t=0;t<4;t++)e[t][0]=0,e[t][1]=0;switch(Math.floor(4*r.a.getUniform())){case 0:e[0][0]=-1,e[1][0]=1,e[2][1]=-1,e[3][1]=1;break;case 1:e[3][0]=-1,e[2][0]=1,e[1][1]=-1,e[0][1]=1;break;case 2:e[2][0]=-1,e[3][0]=1,e[0][1]=-1,e[1][1]=1;break;case 3:e[1][0]=-1,e[0][0]=1,e[3][1]=-1,e[2][1]=1}}_isFree(e,t,i,s,n){return!(t<1||i<1||t>=s||i>=n)&&e[t][i]}},Rogue:class extends n{constructor(e,t,i){super(e,t),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(e){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),e)for(let t=0;t<this._width;t++)for(let i=0;i<this._height;i++)e(t,i,this.map[t][i]);return this}_calculateRoomSize(e,t){let i=Math.floor(e/t*.8),s=Math.floor(e/t*.25);return s<2&&(s=2),i<2&&(i=2),[s,i]}_initRooms(){for(let e=0;e<this._options.cellWidth;e++){this.rooms.push([]);for(let t=0;t<this._options.cellHeight;t++)this.rooms[e].push({x:0,y:0,width:0,height:0,connections:[],cellx:e,celly:t})}}_connectRooms(){let e,t,i,n,o,a,h=r.a.getUniformInt(0,this._options.cellWidth-1),l=r.a.getUniformInt(0,this._options.cellHeight-1),c=!1;do{a=[0,2,4,6],a=r.a.shuffle(a);do{if(c=!1,e=a.pop(),t=h+s.DIRS[8][e][0],i=l+s.DIRS[8][e][1],!(t<0||t>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if((n=this.rooms[h][l]).connections.length>0&&n.connections[0][0]==t&&n.connections[0][1]==i)break;0==(o=this.rooms[t][i]).connections.length&&(o.connections.push([h,l]),this.connectedCells.push([t,i]),h=t,l=i,c=!0)}}while(a.length>0&&0==c)}while(a.length>0)}_connectUnconnectedRooms(){let e,t,i,n=this._options.cellWidth,o=this._options.cellHeight;this.connectedCells=r.a.shuffle(this.connectedCells);for(let a=0;a<this._options.cellWidth;a++)for(let h=0;h<this._options.cellHeight;h++)if(0==(e=this.rooms[a][h]).connections.length){let l=[0,2,4,6];l=r.a.shuffle(l),i=!1;do{let e=l.pop(),r=a+s.DIRS[8][e][0],c=h+s.DIRS[8][e][1];if(!(r<0||r>=n||c<0||c>=o)){if(i=!0,0==(t=this.rooms[r][c]).connections.length)break;for(let e=0;e<t.connections.length;e++)if(t.connections[e][0]==a&&t.connections[e][1]==h){i=!1;break}if(i)break}}while(l.length);i?e.connections.push([t.cellx,t.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let e,t,i,s,n,o=this._width,a=this._height,h=this._options.cellWidth,l=this._options.cellHeight,c=Math.floor(this._width/h),u=Math.floor(this._height/l),_=this._options.roomWidth,d=this._options.roomHeight;for(let m=0;m<h;m++)for(let h=0;h<l;h++){if(0==(i=c*m)&&(i=1),0==(s=u*h)&&(s=1),e=r.a.getUniformInt(_[0],_[1]),t=r.a.getUniformInt(d[0],d[1]),h>0)for(n=this.rooms[m][h-1];s-(n.y+n.height)<3;)s++;if(m>0)for(n=this.rooms[m-1][h];i-(n.x+n.width)<3;)i++;let l=Math.round(r.a.getUniformInt(0,c-e)/2),p=Math.round(r.a.getUniformInt(0,u-t)/2);for(;i+l+e>=o;)l?l--:e--;for(;s+p+t>=a;)p?p--:t--;i+=l,s+=p,this.rooms[m][h].x=i,this.rooms[m][h].y=s,this.rooms[m][h].width=e,this.rooms[m][h].height=t;for(let n=i;n<i+e;n++)for(let e=s;e<s+t;e++)this.map[n][e]=0}}_getWallPosition(e,t){let i,s,n;return 1==t||3==t?(i=r.a.getUniformInt(e.x+1,e.x+e.width-2),n=1==t?1+(s=e.y-2):(s=e.y+e.height+1)-1,this.map[i][n]=0):(s=r.a.getUniformInt(e.y+1,e.y+e.height-2),n=2==t?(i=e.x+e.width+1)-1:1+(i=e.x-2),this.map[n][s]=0),[i,s]}_drawCorridor(e,t){let i,n,o,a,h=t[0]-e[0],l=t[1]-e[1],c=e[0],u=e[1],_=[],d=Math.abs(h),m=Math.abs(l),p=r.a.getUniform(),g=p,f=1-p;for(n=h>0?2:6,o=l>0?4:0,d<m?(i=Math.ceil(m*g),_.push([o,i]),_.push([n,d]),i=Math.floor(m*f),_.push([o,i])):(i=Math.ceil(d*g),_.push([n,i]),_.push([o,m]),i=Math.floor(d*f),_.push([n,i])),this.map[c][u]=0;_.length>0;)for(a=_.pop();a[1]>0;)c+=s.DIRS[8][a[0]][0],u+=s.DIRS[8][a[0]][1],this.map[c][u]=0,a[1]=a[1]-1}_createCorridors(){let e,t,i,s,n,o=this._options.cellWidth,r=this._options.cellHeight;for(let a=0;a<o;a++)for(let o=0;o<r;o++){e=this.rooms[a][o];for(let o=0;o<e.connections.length;o++)t=e.connections[o],(i=this.rooms[t[0]][t[1]]).cellx>e.cellx?(s=2,n=4):i.cellx<e.cellx?(s=4,n=2):i.celly>e.celly?(s=3,n=1):(s=1,n=3),this._drawCorridor(this._getWallPosition(e,s),this._getWallPosition(i,n))}}}}},function(e,t,i){"use strict";(function(e){i.d(t,"a",function(){return r});var s=i(14),n=i(12);function o(e){let t=n.fromString(e);return 36*Math.floor(t[0]*(6/256))+6*Math.floor(t[1]*(6/256))+1*Math.floor(t[2]*(6/256))+16}class r extends s.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(e){setTimeout(e,1e3/60)}setOptions(e){super.setOptions(e);let t=[e.width,e.height],i=this.computeSize();this._offset=i.map((e,i)=>Math.floor((e-t[i])/2))}clear(){e.stdout.write(`[0;48;5;${o(this._options.bg)}m[2J`)}draw(t,i){let[s,n,r,a,h]=t,l=this._offset[0]+s,c=this._offset[1]+n,u=this.computeSize();if(l<0||l>=u[0])return;if(c<0||c>=u[1])return;if(l===this._cursor[0]&&c===this._cursor[1]||(e.stdout.write(function(e,t){return`[${t+1};${e+1}H`}(l,c)),this._cursor[0]=l,this._cursor[1]=c),i&&(r||(r=" ")),!r)return;let _=function(e,t){return`[0;38;5;${o(e)};48;5;${o(t)}m`}(a,h);_!==this._lastColor&&(e.stdout.write(_),this._lastColor=_);let d=[].concat(r);e.stdout.write(d[0]),this._cursor[0]++,this._cursor[0]>=u[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(e,t){return[e,t]}computeSize(){return[e.stdout.columns,e.stdout.rows]}}}).call(this,i(21))},function(e,t){var i,s,n=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{s="function"==typeof clearTimeout?clearTimeout:r}catch(e){s=r}}();var h,l=[],c=!1,u=-1;function _(){c&&h&&(c=!1,h.length?l=h.concat(l):u=-1,l.length&&d())}function d(){if(!c){var e=a(_);c=!0;for(var t=l.length;t;){for(h=l,l=[];++u<t;)h&&h[u].run();u=-1,t=l.length}h=null,c=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===r||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new m(e,t)),1!==l.length||c||a(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2);t.Tile=class{constructor(e,t=" ",i=[0,0,0],n=[255,255,255]){this.visibility=0,this.visited=!1,this._isWalkable=!1,this._isDiggable=!1,this._blocksLight=!1;let o=!1,r=!1,a=!1;switch(e){case"debugWall":a=!1;case"wall":o=!1,r=!1,a=!0;break;case"floor":case"empty":o=!0;break;case"bossTile":o=!1}this.name=e,this._isDiggable=r,this._isWalkable=o,this._blocksLight=a,this.tile=new s.Glyph(t,i,n),this.baseTile=new s.Glyph(t,i,n),this.visitedTile=new s.Glyph(t,i,n);let h=this.tile.foreground;this.visitedTile.foreground=[Math.floor(.2*h[0]),Math.floor(.2*h[1]),Math.floor(.2*h[2])]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Knife=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=2,this.skill_bonus=.8,this.defense_bonus=0,this.hp_bonus=0,this.prefix="",this.name="knife",this.fullname="knife",this.cooldown=6,this.max_cooldown=6,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown,this.glyph=e.glyph;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("⟊",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randperc=function(e){return(Math.random()*e-Math.ceil(e/2))/100}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(13),n=i(48),o=i(49),r=i(50),a=i(2),h=i(17),l=i(51),c=i(52),u=i(53),_=i(24),d=i(54),m=i(55);t.CreateMonster=function(e,t,i,p){let g=p/10,f=_.randperc(100)+.2+g,w=_.randperc(50)+g,y=_.randperc(30)+g/2;p<10?y=_.randperc(30)+g:f+=g/8;let x=(f>0?f:.5*f)+(w>0?2*w:.5*w)+(y>0?3*y:.5*y);if(x/=3,"fungi"==e){let e=new h.Fighter(30+30*f,2+2*y,4+4*w,25+25*x),o=new n.Fungi;return new s.Entity(t,i,new a.Glyph("f",[0,0,0],[0,200,0]),"Fungi",1,!0,8,2,e,o)}if("orc"==e){let e=new h.Fighter(40+40*f,2+2*y,4+4*w,35+35*x),n=new o.Orc;return new s.Entity(t,i,new a.Glyph("o",[0,0,0],[0,128,0]),"Orc",1,!0,7,2,e,n)}if("dummy"==e){let e=new h.Fighter(400+40*f,0,0+0*w,0),n=new m.DummyTarget;return new s.Entity(t,i,new a.Glyph("☺",[0,0,0],[128,128,0]),"Dummy",1,!0,5,2,e,n)}if("troll"==e){let e=new h.Fighter(90+90*f,3+3*y,8+8*w,60+60*x),n=new r.Troll;return new s.Entity(t,i,new a.Glyph("t",[0,0,0],[128,0,128]),"Troll",1,!0,7,2,e,n)}if("wyvern"==e){let e=new h.Fighter(30+30*f,2+2*y,5+5*w,20+20*x),n=new c.Wyvern;return new s.Entity(t,i,new a.Glyph("w",[0,0,0],[148,0,211]),"Wyvern",1,!0,6,2,e,n)}if("ranger"==e){let e=new h.Fighter(40+40*f,3+3*y,8+8*w,40+40*x),n=new l.Ranger;return new s.Entity(t,i,new a.Glyph("r",[0,0,0],[233,150,122]),"Ranger",1,!0,5,2,e,n)}if("crawler"==e){let e=new h.Fighter(60+60*f,5+5*y,8+8*w,50+50*x),n=new d.Crawler;return new s.Entity(t,i,new a.Glyph("c",[0,0,0],[172,30,155]),"Crawler",1,!0,3,2,e,n)}if("dragon"==e){let e=new h.Fighter(100+100*f,6+6*y,20+20*w,300+300*x),n=new u.Dragon;return new s.Entity(t,i,new a.Glyph("Đ",[0,0,0],[220,20,60]),"Dragon",1,!0,5,2,e,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Exit=class{constructor(e){this._map=e}climb(){this._map.owner.level+=1,this._map.owner.switchScreen(this._map.owner.Screen.playScreen)}}},function(e,t,i){"use strict";e.exports=function(e,t){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return e.apply(t,i)}}},function(e,t,i){"use strict";var s=i(3);function n(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,i){if(!t)return e;var o;if(i)o=i(t);else if(s.isURLSearchParams(t))o=t.toString();else{var r=[];s.forEach(t,function(e,t){null!=e&&(s.isArray(e)?t+="[]":e=[e],s.forEach(e,function(e){s.isDate(e)?e=e.toISOString():s.isObject(e)&&(e=JSON.stringify(e)),r.push(n(t)+"="+n(e))}))}),o=r.join("&")}if(o){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,i){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,i){"use strict";(function(t){var s=i(3),n=i(70),o={"Content-Type":"application/x-www-form-urlencoded"};function r(e,t){!s.isUndefined(e)&&s.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a,h={adapter:(void 0!==t&&"[object process]"===Object.prototype.toString.call(t)?a=i(31):"undefined"!=typeof XMLHttpRequest&&(a=i(31)),a),transformRequest:[function(e,t){return n(t,"Accept"),n(t,"Content-Type"),s.isFormData(e)||s.isArrayBuffer(e)||s.isBuffer(e)||s.isStream(e)||s.isFile(e)||s.isBlob(e)?e:s.isArrayBufferView(e)?e.buffer:s.isURLSearchParams(e)?(r(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):s.isObject(e)?(r(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};h.headers={common:{Accept:"application/json, text/plain, */*"}},s.forEach(["delete","get","head"],function(e){h.headers[e]={}}),s.forEach(["post","put","patch"],function(e){h.headers[e]=s.merge(o)}),e.exports=h}).call(this,i(21))},function(e,t,i){"use strict";var s=i(3),n=i(71),o=i(28),r=i(73),a=i(74),h=i(32);e.exports=function(e){return new Promise(function(t,l){var c=e.data,u=e.headers;s.isFormData(c)&&delete u["Content-Type"];var _=new XMLHttpRequest;if(e.auth){var d=e.auth.username||"",m=e.auth.password||"";u.Authorization="Basic "+btoa(d+":"+m)}if(_.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),_.timeout=e.timeout,_.onreadystatechange=function(){if(_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in _?r(_.getAllResponseHeaders()):null,s={data:e.responseType&&"text"!==e.responseType?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:i,config:e,request:_};n(t,l,s),_=null}},_.onabort=function(){_&&(l(h("Request aborted",e,"ECONNABORTED",_)),_=null)},_.onerror=function(){l(h("Network Error",e,null,_)),_=null},_.ontimeout=function(){l(h("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",_)),_=null},s.isStandardBrowserEnv()){var p=i(75),g=(e.withCredentials||a(e.url))&&e.xsrfCookieName?p.read(e.xsrfCookieName):void 0;g&&(u[e.xsrfHeaderName]=g)}if("setRequestHeader"in _&&s.forEach(u,function(e,t){void 0===c&&"content-type"===t.toLowerCase()?delete u[t]:_.setRequestHeader(t,e)}),e.withCredentials&&(_.withCredentials=!0),e.responseType)try{_.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&_.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){_&&(_.abort(),l(e),_=null)}),void 0===c&&(c=null),_.send(c)})}},function(e,t,i){"use strict";var s=i(72);e.exports=function(e,t,i,n,o){var r=new Error(e);return s(r,t,i,n,o)}},function(e,t,i){"use strict";var s=i(3);e.exports=function(e,t){t=t||{};var i={};return s.forEach(["url","method","params","data"],function(e){void 0!==t[e]&&(i[e]=t[e])}),s.forEach(["headers","auth","proxy"],function(n){s.isObject(t[n])?i[n]=s.deepMerge(e[n],t[n]):void 0!==t[n]?i[n]=t[n]:s.isObject(e[n])?i[n]=s.deepMerge(e[n]):void 0!==e[n]&&(i[n]=e[n])}),s.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(s){void 0!==t[s]?i[s]=t[s]:void 0!==e[s]&&(i[s]=e[s])}),i}},function(e,t,i){"use strict";function s(e){this.message=e}s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,e.exports=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(18),n=i(36),o=i(80),r=i(81);class a{constructor(){this._messageBoxSize=10,this._screenWidth=74,this._screenHeight=40,this._entities=[],this.timer=!0,this.level=0,this.blinkLevel=0,this.lang="En",this.mainmenuOpt=0,this.endMessage="[A] n d  s o . . . w e  f a l l  a g a i n . . .",this.iControl=0,this.clr=255,this.scores=[],this.starttime=0,this.endtime=0,this._centerX=0,this._centerY=0,this._display=null,this._currentScreen=null,this.Screen={startScreen:n.startScreen(),debugScreen:n.debugScreen(),playScreen:n.playScreen(),winScreen:n.winScreen(),loseScreen:n.loseScreen(),scoreScreen:n.scoreScreen()},this._map=null,this._entities=new Array}init(){this.logo=r.Logo(),this._display=new s.Display({width:this._screenWidth,height:this._screenHeight,forceSquareRatio:!0,fontFamily:"Courier",fontStyle:"bold",spacing:.75}),this._inventory=new s.Display({width:20,height:.8*this._screenHeight}),this._messaging=new s.Display({width:1.5*this._screenWidth,height:this._messageBoxSize}),this.messageLog=new o.Messagelog(0,this._screenHeight,this._messageBoxSize,this),this.messageLog.messages=[{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"},{message:"",color0:[0,0,0],color1:[0,0,0],color2:[0,0,0],type:"empty"}];let e=document.getElementById("menu");window.addEventListener("keydown",e=>{null!==this._currentScreen&&(this._currentScreen.handleInput("keydown",e,this),this._display.clear(),this._currentScreen.render(this._display,this))}),window.onkeydown=e=>{8==e.keyCode&&e.target==document.body&&e.preventDefault()},e.addEventListener("click",e=>{this._currentScreen.handleInput("click",e,this),this._display.clear(),this._currentScreen.render(this._display,this)})}getDisplay(){return this._display}getInventory(){return this._inventory}getMessaging(){return this._messaging}writeMessages(){let e=0,t=0,i="",s="",n="",o="",r="",a="",h="";for(let l of this.messageLog.messages){let c="%c{rgb("+(255*(t+=.1)).toString()+","+(255*t).toString()+","+(255*t).toString()+")}";i="%c{rgb("+Math.round(l.color0[0]*t).toString()+","+Math.round(l.color0[1]*t).toString()+","+Math.round(l.color0[2]*t).toString()+")}",s="%c{rgb("+Math.round(l.color1[0]*t).toString()+","+Math.round(l.color1[1]*t).toString()+","+Math.round(l.color1[2]*t).toString()+")}",n="%c{rgb("+Math.round(l.color2[0]*t).toString()+","+Math.round(l.color2[1]*t).toString()+","+Math.round(l.color2[2]*t).toString()+")}",h=(a=(r=(o=l.message.replace(/%c\{0}/g,i)).replace(/%c\{1}/g,s)).replace(/%c\{2}/g,n)).replace(/%c\{base}/g,c),this._messaging.drawText(1,e,""+h,2*this._screenWidth),e+=1}}writeStats(){let e=this._player.fighter.hp.toFixed(2),t=this._player.fighter.max_hp();if(this._inventory.drawText(0,1,"Status: "),"En"==this.lang){if(this._inventory.drawText(1,3,"%c{rgb(255,0,0)}HP: %c{}"+e+"/"+t),this._inventory.drawText(1,4,"%c{blue}Atk: %c{}"+this._player.fighter.power().toFixed(2)),this._inventory.drawText(1,5,"%c{yellow}Def: %c{}"+this._player.fighter.defense().toFixed(2)),this._player.fighter.unspentPoints>0){let e="";this.blinkLevel<2&&(e="%c{rgb(140, 140, 140)}"),this.blinkLevel>=2&&(e="%c{rgb(240, 240, 240)}"),this.blinkLevel>5&&(this.blinkLevel=0),this.blinkLevel+=1,this._inventory.drawText(1,7,e+" LEVEL UP! : "+this._player.fighter.unspentPoints),this._inventory.drawText(1,8,"%c{rgb(24,191,230)}Might: %c{}"+this._player.fighter.base_power.toFixed(2)+e+" (a)"),this._inventory.drawText(1,9,"%c{rgb(211, 234, 49)}Resist: %c{}"+this._player.fighter.base_defense.toFixed(2)+e+" (s)"),this._inventory.drawText(1,10,"%c{rgb(230, 121, 70)}Base HP: %c{}"+this._player.fighter.base_max_hp.toFixed(2)+e+" (d)")}else this._inventory.drawText(1,8,"%c{rgb(24,191,230)}Might: %c{}"+this._player.fighter.base_power.toFixed(2)),this._inventory.drawText(1,9,"%c{rgb(211, 234, 49)}Resist: %c{}"+this._player.fighter.base_defense.toFixed(2)),this._inventory.drawText(1,10,"%c{rgb(230, 121, 70)}Base HP: %c{}"+this._player.fighter.base_max_hp.toFixed(2));this._inventory.drawText(1,12,"%c{rgb(140, 140, 160)}Rank: %c{}"+this._player.fighter.rank),this._inventory.drawText(1,13,"%c{rgb(140, 140, 160)}Exp: %c{}"+this._player.fighter.current_exp.toFixed(2)+"/"+this._player.fighter.nextRank.toFixed(2)),null!=this._player.equipment&&(this._inventory.drawText(1,15,"%c{rgb(140, 140, 160)}Main: %c{rgb("+this._player.equipment.glyph.foreground.toString()+")}"+this._player.equipment.name),this._inventory.drawText(3,16,"%c{rgb(140, 140, 160)}atk: %c{}"+this._player.equipment.power_bonus.toFixed(2)),this._inventory.drawText(3,17,"%c{rgb(140, 140, 160)}skl: %c{}"+this._player.equipment.skill_bonus.toFixed(2)),this._inventory.drawText(3,18,"%c{rgb(140, 140, 160)}def: %c{}"+this._player.equipment.defense_bonus.toFixed(2)),this._inventory.drawText(3,19,"%c{rgb(140, 140, 160)}hp: %c{}"+this._player.equipment.hp_bonus.toFixed(2)),this._inventory.drawText(3,20,"%c{rgb(140, 140, 160)}cd: %c{}"+(this._player.equipment.max_cooldown-this._player.equipment.cooldown).toFixed(0)+"/"+this._player.equipment.max_cooldown.toFixed(0))),null!=this._player.subequipment?(this._inventory.drawText(1,22,"%c{rgb(140, 140, 160)}Sub: %c{}"+this._player.subequipment.name),this._inventory.drawText(3,23,"%c{rgb(140, 140, 160)}atk: %c{}"+this._player.subequipment.power_bonus.toFixed(2)),this._inventory.drawText(3,24,"%c{rgb(140, 140, 160)}skl: %c{}"+this._player.subequipment.skill_bonus.toFixed(2)),this._inventory.drawText(3,25,"%c{rgb(140, 140, 160)}def: %c{}"+this._player.subequipment.defense_bonus.toFixed(2)),this._inventory.drawText(3,26,"%c{rgb(140, 140, 160)}hp: %c{}"+this._player.subequipment.hp_bonus.toFixed(2)),this._inventory.drawText(3,27,"%c{rgb(140, 140, 160)}cd: %c{}"+(this._player.subequipment.max_cooldown-this._player.subequipment.cooldown).toFixed(0)+"/"+this._player.subequipment.max_cooldown.toFixed(0)),this._inventory.drawText(1,29,"%c{rgb(0, 255, 102)}Potions: %c{}"+this._player.inventory+" [p]")):this._inventory.drawText(1,22,"%c{rgb(0, 255, 102)}Potions: %c{}"+this._player.inventory+" [p]"),this._inventory.drawText(1,31,"%c{rgb(140, 140, 160)}Floor: %c{}"+this._map.dungeon_level)}else if(this.lang="Pt"){if(this._inventory.drawText(1,3,"%c{rgb(255,0,0)}PV: %c{}"+e+"/"+t),this._inventory.drawText(1,4,"%c{blue}Ataque: %c{}"+this._player.fighter.power().toFixed(2)),this._inventory.drawText(1,5,"%c{yellow}Defesa: %c{}"+this._player.fighter.defense().toFixed(2)),this._player.fighter.unspentPoints>0){let e="";this.blinkLevel<2&&(e="%c{rgb(140, 140, 140)}"),this.blinkLevel>=2&&(e="%c{rgb(240, 240, 240)}"),this.blinkLevel>5&&(this.blinkLevel=0),this.blinkLevel+=1,this._inventory.drawText(1,7,e+" SUBIU DE NIVEL! : "+this._player.fighter.unspentPoints),this._inventory.drawText(1,8,"%c{rgb(24,191,230)}Força: %c{}"+this._player.fighter.base_power.toFixed(2)+e+" (a)"),this._inventory.drawText(1,9,"%c{rgb(211, 234, 49)}Proteção: %c{}"+this._player.fighter.base_defense.toFixed(2)+e+" (s)"),this._inventory.drawText(1,10,"%c{rgb(230, 121, 70)}PV Base: %c{}"+this._player.fighter.base_max_hp.toFixed(2)+e+" (d)")}else this._inventory.drawText(1,8,"%c{rgb(24,191,230)}Força: %c{}"+this._player.fighter.base_power.toFixed(2)),this._inventory.drawText(1,9,"%c{rgb(211, 234, 49)}Proteção: %c{}"+this._player.fighter.base_defense.toFixed(2)),this._inventory.drawText(1,10,"%c{rgb(230, 121, 70)}PV Base: %c{}"+this._player.fighter.base_max_hp.toFixed(2));this._inventory.drawText(1,12,"%c{rgb(140, 140, 160)}Rank: %c{}"+this._player.fighter.rank),this._inventory.drawText(1,13,"%c{rgb(140, 140, 160)}Exp: %c{}"+this._player.fighter.current_exp.toFixed(2)+"/"+this._player.fighter.nextRank.toFixed(0)),null!=this._player.equipment&&(this._inventory.drawText(1,15,"%c{rgb(140, 140, 160)}Prima: %c{rgb("+this._player.equipment.glyph.foreground.toString()+")}"+this._player.equipment.name),this._inventory.drawText(3,16,"%c{rgb(140, 140, 160)}atq: %c{}"+this._player.equipment.power_bonus.toFixed(2)),this._inventory.drawText(3,17,"%c{rgb(140, 140, 160)}hab: %c{}"+this._player.equipment.skill_bonus.toFixed(2)),this._inventory.drawText(3,18,"%c{rgb(140, 140, 160)}def: %c{}"+this._player.equipment.defense_bonus.toFixed(2)),this._inventory.drawText(3,19,"%c{rgb(140, 140, 160)}pv: %c{}"+this._player.equipment.hp_bonus.toFixed(2)),this._inventory.drawText(3,20,"%c{rgb(140, 140, 160)}cd: %c{}"+(this._player.equipment.max_cooldown-this._player.equipment.cooldown).toFixed(0)+"/"+this._player.equipment.max_cooldown.toFixed(0))),null!=this._player.subequipment?(this._inventory.drawText(1,22,"%c{rgb(140, 140, 160)}Secnd: %c{}"+this._player.subequipment.name),this._inventory.drawText(3,23,"%c{rgb(140, 140, 160)}atq: %c{}"+this._player.subequipment.power_bonus.toFixed(2)),this._inventory.drawText(3,24,"%c{rgb(140, 140, 160)}hab: %c{}"+this._player.subequipment.skill_bonus.toFixed(2)),this._inventory.drawText(3,25,"%c{rgb(140, 140, 160)}def: %c{}"+this._player.subequipment.defense_bonus.toFixed(2)),this._inventory.drawText(3,26,"%c{rgb(140, 140, 160)}pv: %c{}"+this._player.subequipment.hp_bonus.toFixed(2)),this._inventory.drawText(3,27,"%c{rgb(140, 140, 160)}cd: %c{}"+(this._player.subequipment.max_cooldown-this._player.subequipment.cooldown).toFixed(0)+"/"+this._player.subequipment.max_cooldown.toFixed(0)),this._inventory.drawText(1,29,"%c{rgb(0, 255, 102)}Poções: %c{}"+this._player.inventory+" [p]")):this._inventory.drawText(1,22,"%c{rgb(0, 255, 102)}Poções: %c{}"+this._player.inventory+" [p]"),this._inventory.drawText(1,31,"%c{rgb(140, 140, 160)}Andar: %c{}"+this._map.dungeon_level)}}switchScreen(e){null!==this._currentScreen&&this._currentScreen.exit(this),this.getDisplay().clear(),this._currentScreen=e,null!==!this._currentScreen&&(this._currentScreen.enter(this),this.refresh())}refresh(){this._display.clear(),this._messaging.clear(),this._inventory.clear(),this._currentScreen==this.Screen.playScreen&&(this.writeMessages(),this.writeStats()),this._currentScreen.render(this._display,this)}startCountDown(){let e=1;var t=setInterval(()=>{--e<0&&(this.timer?e=1:clearInterval(t),this.refresh())},50)}}t.Game=a,window.onload=function(){let e=new a;e.init(),document.getElementById("game").appendChild(e.getDisplay().getContainer()),document.getElementById("menu").appendChild(e.getInventory().getContainer()),document.getElementById("info").appendChild(e.getMessaging().getContainer()),e.startCountDown(),e.switchScreen(e.Screen.startScreen)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(37),n=i(1),o=i(12),r=i(22),a=i(19),h=i(13),l=i(10),c=i(23),u=i(62),_=i(15),d=i(26),m=i(2),p=i(25),g=i(17),f=i(63);function w(e){let t=l.randint(0,9);e.level>10&&(t=l.randint(0,1)),e._map=new s.Map(120,88),e._map.owner=e;let i=new r.Tile("empty"," ",[0,0,0],[255,255,255]);console.log("Entered play screen.");for(let t=0;t<120;t++){e._map._tiles.push([]);for(let s=0;s<88;s++)e._map._tiles[t].push(i)}let n=new a.default.Cellular(120,88);n.randomize(.66);for(let e=0;e<2;e++)n.create();return n.create((i,s,n)=>{e._map._tiles[i][s]=1===n?t?new r.Tile("floor",".",[0,0,0],[84,54,11]):new r.Tile("floor",".",[0,0,0],[60,11,85]):t?new r.Tile("wall","#",[0,0,0],[218,165,32]):new r.Tile("wall","#",[0,0,0],[102,33,218]),0!=i&&0!=s&&119!=i&&87!=s||(e._map._tiles[i][s]=t?new r.Tile("wall","#",[0,0,0],[218,165,32]):new r.Tile("wall","#",[0,0,0],[102,33,218]))}),t}function y(e){let t=l.randint(0,9);e.level>10&&(t=l.randint(0,1)),e._map=new s.Map(120,88),e._map.owner=e;let i=new r.Tile("empty"," ",[0,0,0],[255,255,255]);for(let t=0;t<120;t++){e._map._tiles.push([]);for(let s=0;s<88;s++)e._map._tiles[t].push(i)}let n=u.generateDunMaze(120,88);for(let i=0;i<120;i++)for(let s=0;s<88;s++)1==n[i][s]&&(e._map._tiles[i][s]=t?new r.Tile("wall","#",[0,0,0],[128,128,128]):new r.Tile("wall","#",[0,0,0],[255,30,30])),0==n[i][s]&&(e._map._tiles[i][s]=t?new r.Tile("floor","·",[0,0,0],[60,60,60]):new r.Tile("floor","·",[0,0,0],[80,15,15])),2==n[i][s]&&(e._map._tiles[i][s]=new r.Tile("floor","E",[0,0,0],[200,0,0]));return t}function x(e){e._map=new s.Map(70,38),e._map.owner=e;let t=new r.Tile("empty"," ",[0,0,0],[255,255,255]);console.log("Entered play screen.");for(let i=0;i<70;i++){e._map._tiles.push([]);for(let s=0;s<38;s++)e._map._tiles[i].push(t)}for(let t=0;t<70;t++)for(let i=0;i<38;i++)e._map._tiles[t][i]=0==t||69==t||0==i||37==i?new r.Tile("wall","#",[0,0,0],[128,128,128]):new r.Tile("floor","·",[0,0,0],[66,7,7])}function b(){return{enter:e=>{e.bg.pause(),console.log("Entered win screen."),e.endtime=Math.floor(Date.now()/6e4);let t=e.endtime-e.starttime;e._player.lastxp,e.level>8||e.level,Math.sqrt(t),f.default.post("https://at-the-tsbyss-leaderboard.herokuapp.com/api/score",{name:e._player.name,score:(e._player.lastxp*(e.level>8?8+(e.level-8)/2:e.level)).toFixed(2).toString(),killedby:e._player.killedby}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})},exit:e=>{console.log("Exited win screen.")},render:(e,t)=>{e.drawText(2,16,"%c{rgb(200,200,200)}your future is here, welcome"),e.drawText(35,18,"%c{rgb(120,120,120)}l o o k a r o u n d");let i="or... do you want to [P]ress on...?";for(let s=0;s<t.iControl;s++)e.draw(s+20,30,i[s],o.toRGB([t.clr,t.clr,t.clr]),o.toRGB([0,0,0])),t.clr-=4;t.iControl<=i.length&&(t.iControl+=1),t.clr=255},handleInput:(e,t,i)=>{"keydown"===e&&(t.keyCode!==n.KEYS.VK_A&&t.keyCode!==n.KEYS.VK_R&&t.keyCode!==n.KEYS.VK_RETURN||(i.switchScreen(i.Screen.startScreen),i.clr=255,i.iControl=0,i.level=0,i.starttime=0),t.keyCode===n.KEYS.VK_P&&(i.clr=255,i.iControl=0,i.level+=13,i.switchScreen(i.Screen.playScreen)))}}}function k(e){return e._entities.sort(function(e,t){return e.render_order==t.render_order?0:1==e.render_order?-1:1==t.render_order?1:e.render_order<t.render_order?-1:e.render_order>t.render_order?1:0})}function v(e){for(let t=0;t<e.length;t++)null!=e[t].damage&&e[t].damage.expire&&(e.splice(t,1),t--),null!=e[t].item&&e[t].item.expire&&(e.splice(t,1),t--)}t.startScreen=function(){return{enter:e=>{e.bg=document.getElementById("mainbg"),e.bg.play();let t=new g.Fighter(100,1,4,0),i=new h.Entity(60,45,new m.Glyph("@",[0,0,0],[0,191,255]),"",1,!0,1,1,t,void 0,!0);i.fighter.unspentPoints=2,e._player=i,e._entities=[e._player],e._player.equipStart(_.CreateItem("knife",e._player.x,e._player.y,1)),e._player.equipment.owner=e._player,console.log("enter"),f.default.get("https://at-the-tsbyss-leaderboard.herokuapp.com/api/leaderboard?page=1&limit=30").then(function(t){t.data.docs.sort((e,t)=>t.score-e.score),e.scores=t.data.docs}).catch(function(t){console.log(t),e.scores.push({name:"failed to connect to leaderboads",score:"",killedby:""})})},exit:e=>{console.log("Exited start screen."),e.bg.pause()},render:(e,t)=>{e.drawText(1,1,"%c{rgb(100, 100, 100)}Beta: v.190719");let i=8;for(const s of t.logo)e.drawText(10,i,s),i+=1;let s="";t.blinkLevel<2&&(s="%c{rgb(140, 140, 140)}"),t.blinkLevel>=2&&(s="%c{rgb(240, 240, 240)}"),t.blinkLevel>4&&(t.blinkLevel=-1),t.blinkLevel+=1,e.drawText(t._screenWidth/2-3,t._screenHeight-13,"%c{rgb(0, 191, 255)}So... you are awake..."),e.drawText(t._screenWidth/2-5,t._screenHeight-11,"%c{rgb(0, 191, 255)}Who are you? %c{}"+t._entities[0].name+s+"_<"),0==t.mainmenuOpt&&e.drawText(t._screenWidth/2-1,t._screenHeight-8,"%c{yellow}>Eng%c{}      Port"),1==t.mainmenuOpt&&e.drawText(t._screenWidth/2,t._screenHeight-8,"Eng     %c{yellow}>Port%c{}"),e.drawText(t._screenWidth/2+15,t._screenHeight-1,"%c{yellow}Ctrlkey%c{}: leaderboards"),e.drawText(t._screenWidth/10,t._screenHeight-4,"%c{yellow}Arrow%c{}: move/attack"),e.drawText(t._screenWidth/10,t._screenHeight-3,"%c{yellow}Enter%c{}: pickup itens/open door"),e.drawText(t._screenWidth/10,t._screenHeight-2,"%c{yellow}Space%c{}: use weapon skill"),e.drawText(t._screenWidth/10,t._screenHeight-1,"%c{yellow}P Key%c{}: use potion")},handleInput:(e,t,i)=>{if("keydown"===e){if((t.keyCode===n.KEYS.VK_RETURN||t.keyCode===n.KEYS.VK_ENTER)&&(0==i.mainmenuOpt&&(i.lang="En"),1==i.mainmenuOpt&&(i.lang="Pt"),i._entities[0].name.length>0)){let e=function(e){var t=function(e){for(var t=5381,i=0;i<e.length;i++)t=(t<<5)+t+e.charCodeAt(i);return t}(e),i=(65280&t)>>8,s=255&t;return"#"+("0"+((16711680&t)>>16).toString(16)).substr(-2)+("0"+i.toString(16)).substr(-2)+("0"+s.toString(16)).substr(-2)}(i._entities[0].name);i._entities[0].glyph.foreground[0]=o.fromString(e)[0],i._entities[0].glyph.foreground[1]=o.fromString(e)[1],i._entities[0].glyph.foreground[2]=o.fromString(e)[2],i.switchScreen(i.Screen.playScreen),0==i.starttime&&(i.starttime=Math.floor(Date.now()/6e4))}t.keyCode===n.KEYS.VK_LEFT&&(i.mainmenuOpt-=1,i.mainmenuOpt<0&&(i.mainmenuOpt=0)),t.keyCode===n.KEYS.VK_RIGHT&&(i.mainmenuOpt+=1,i.mainmenuOpt>1&&(i.mainmenuOpt=1)),t.keyCode>=65&&t.keyCode<=90&&i._entities[0].name.length<=20&&(i._entities[0].name=i._entities[0].name+t.key),8==t.keyCode&&i._entities[0].name.length>0&&(i._entities[0].name=i._entities[0].name.slice(0,-1)),32==t.keyCode&&i._entities[0].name.length>0&&(i._entities[0].name=i._entities[0].name+" "),17==t.keyCode&&i.switchScreen(i.Screen.scoreScreen)}}}},t.debugScreen=function(){return{enter:e=>{y(e),e._map._entities=[];let t=new c.Knife;t.owner=e._player,e._player.equipment=t,e._map._entities.push(e._player),e._player._map=e._map,e._map._display=e._display,e._map.messageLog=e.messageLog,e.timer=!0,e._map.addEntityToMap("cave"),e._entities=e._map._entities},exit:()=>{console.log("Exited play screen.")},render:(e,t)=>{let i=t._screenWidth,s=t._screenHeight,n=t._player,r=Math.max(0,n.x-i/2);r=Math.min(r,t._map._width-i);let a=Math.max(0,n.y-s/2);a=Math.min(a,t._map._height-s);for(let n=r;n<r+i;n++)for(let i=a;i<a+s;i++){let s=t._map.getTile(n,i);e.draw(n-r,i-a,s.visitedTile.char,o.toRGB(s.tile.foreground),o.toRGB(s.tile.background))}v(t._entities),t._map._entities=k(t),t._entities=t._map._entities;for(let i=t._entities.length-1;i>=0;i--)if(0!=t._map.getTile(t._entities[i].x,t._entities[i].y).visibility){let s=Math.pow(t._entities[0].x-t._entities[i].x,2),n=Math.pow(t._entities[0].y-t._entities[i].y,2),h=Math.sqrt(s+n);(0==h||h<=t._entities[0].sight)&&e.draw(t._entities[i].x-r,t._entities[i].y-a,t._entities[i].glyph.char,o.toRGB(t._entities[i].glyph.foreground),o.toRGB(t._entities[i].glyph.background))}},handleInput:(e,t,i)=>{if("keydown"===e)switch(t.keyCode){case n.KEYS.VK_RETURN:let e=i._map.getItemAt(i._entities[0].x,i._entities[0].x2,i._entities[0].y,i._entities[0].y2);e.length>0&&i._entities[0].equip(e[0]);break;case n.KEYS.VK_ESCAPE:i.timer=!1;break;case n.KEYS.VK_SPACE:null!=i._entities[0].equipment&&i._entities[0].equipment.strike();break;case n.KEYS.VK_LEFT:i._entities[0].move(-1,0,i._map);break;case n.KEYS.VK_DOWN:i._entities[0].move(0,1,i._map);break;case n.KEYS.VK_UP:i._entities[0].move(0,-1,i._map);break;case n.KEYS.VK_RIGHT:i._entities[0].move(1,0,i._map)}}}},t.playScreen=function(){return{enter:e=>{let t=99;if(0==e.level){e.bg=document.getElementById("introbg"),e.bg.play(),e.bg.loop=!0,function(e){e._map=new s.Map(21,31),e._map.owner=e;let t=new r.Tile("empty"," ",[0,0,0],[255,255,255]);console.log("Entered play screen.");for(let i=0;i<21;i++){e._map._tiles.push([]);for(let s=0;s<31;s++)e._map._tiles[i].push(t)}for(let t=0;t<21;t++)for(let i=0;i<31;i++)e._map._tiles[t][i]=(t<4||t>16)&&(i<8||i>22)?new r.Tile("wall","#",[0,0,0],[128,128,128]):new r.Tile("floor","·",[0,0,0],[60,60,60]),0!=t&&20!=t&&0!=i&&30!=i||(e._map._tiles[t][i]=new r.Tile("wall","#",[0,0,0],[128,128,128]))}(e),e._player.x=10,e._player.x2=10,e._player.y=28,e._player.y2=28,e._map._entities.push(e._player),e._player._map=e._map,e._map._display=e._display,e._map.messageLog=e.messageLog,e.timer=!0,e._map.dungeon_level=e.level;let t=new d.Exit(e._map),i=new h.Entity(10,2,new m.Glyph("⍝",[0,0,0],[20,150,200]),"saida",1,!1,-1,2,void 0,void 0,!1,void 0,void 0,void 0,t);e._map._entities.push(i);let n=p.CreateMonster("dummy",10,5,1);n._map=e._map,e._map._entities.push(n);let o=[6,10,14],a=[12,10,12];for(let t=0;t<3;t++){let i=l.randint(0,4),s="";0==i&&(s="potion"),1==i&&(s="knife"),2==i&&(s="knife"),3==i&&(s="dagger"),4==i&&(s="dagger");let n=_.CreateItem(s,o[t],a[t],e.level);n._map=this,e._map._entities.push(n)}return void(e._entities=e._map._entities)}let i="";if(e.level>0&&e.level<=2&&(e.bg.pause(),e.bg=document.getElementById("easybg"),e.bg.play(),e.bg.loop=!0,t=w(e),i="cave",1==e.level&&(t=1)),(e.level>2&&e.level<=4||e.level>10&&"7"!=e.level.toString()[e.level.toString().length-1])&&(3==e.level&&(e.bg.pause(),e.bg=document.getElementById("midbg"),e.bg.play(),e.bg.loop=!0),100*Math.random()<51?(t=w(e),i="cave"):(t=y(e),i="dungeon")),e.level>=5&&e.level<7&&(t=y(e),i="dungeon"),8==e.level&&(e.bg.pause(),e.bg=document.getElementById("bossbg"),e.bg.play(),e.bg.loop=!0,e.switchScreen(b)),"7"==e.level.toString()[e.level.toString().length-1])return x(e),e._player.x=10,e._player.x2=10,e._player.y=28,e._player.y2=28,e._map._entities.push(e._player),e._player._map=e._map,e._map._display=e._display,e._map.messageLog=e.messageLog,e.timer=!0,e._map.dungeon_level=e.level,e._map.addBossToMap(),void(e._entities=e._map._entities);e._map._entities=[],e._map._entities.push(e._player);let n=!0;for(;n;){let t=l.randint(0,e._map._width-1),i=l.randint(0,e._map._height-1);0==e._map.getTile(t,i)._isWalkable?n=!0:(e._player.x=t,e._player.x2=t,e._player.y=i,e._player.y2=i,n=!1)}e._player._map=e._map,e._map._display=e._display,e._map.messageLog=e.messageLog,e.timer=!0,t?(e._map.dungeon_level=e.level,e._map.addEntityToMap(i)):(e._map.dungeon_level=e.level+2,e._map.addEntityToMap(i),e._map.dungeon_level-=2),e._entities=e._map._entities},exit:e=>{console.log("Exited play screen.");for(let t=0;t<e._map._entities.length;t++){let i=e._map._entities[t];null!=i.fighter&&0==i.player&&(i.fighter.hp=0)}e._map._entities=[],e._map._tiles=[]},render:(e,t)=>{let i=t._screenWidth,s=t._screenHeight;if("dead"==t._player.fighter.status)return void t.switchScreen(t.Screen.loseScreen);let n=t._player,a=Math.max(0,n.x-i/2);a=Math.min(a,t._map._width-i);let h=Math.max(0,n.y-s/2);if(h=Math.min(h,t._map._height-s),t.level%7!=0){for(let n=a;n<a+i;n++)for(let i=h;i<h+s;i++){let s=t._map.getTile(n,i);s.visited?e.draw(n-a,i-h,s.visitedTile.char,o.toRGB(s.visitedTile.foreground),o.toRGB(s.visitedTile.background)):e.draw(n-a,i-h," ",o.toRGB([0,0,0]),o.toRGB([0,0,0]))}t._map.setupFov(a,h)}else for(let n=a;n<a+i;n++)for(let i=h;i<h+s;i++){let s=t._map.getTile(n,i);"bossTile"==s.name&&(t._map._tiles[n][i]=new r.Tile("floor","·",[0,0,0],[66,7,7])),e.draw(n-a,i-h,s.baseTile.char,o.toRGB(s.baseTile.foreground),o.toRGB(s.baseTile.background))}if(v(t._entities),t._map._entities=k(t),t._entities=t._map._entities,t.level%7!=0){for(let i=t._entities.length-1;i>=0;i--)if(t._map.getTile(t._entities[i].x,t._entities[i].y).visibility>0){let s=Math.pow(t._entities[0].x-t._entities[i].x,2),n=Math.pow(t._entities[0].y-t._entities[i].y,2),r=Math.sqrt(s+n);(0==r||r<=t._entities[0].sight)&&e.draw(t._entities[i].x-a,t._entities[i].y-h,t._entities[i].glyph.char,o.toRGB(t._entities[i].glyph.foreground),o.toRGB(t._entities[i].glyph.background))}}else for(let i=t._entities.length-1;i>=0;i--)if(null==t._entities[i].boss)e.draw(t._entities[i].x-a,t._entities[i].y-h,t._entities[i].glyph.char,o.toRGB(t._entities[i].glyph.foreground),o.toRGB(t._entities[i].glyph.background));else{for(let e=t._entities[i].x;e<t._entities[i].x2;e++)for(let s=t._entities[i].y;s<t._entities[i].y2;s++)t._map._tiles[e][s]=new r.Tile("bossTile"," ");for(let s=0;s<t._entities[i].boss.length-1;s++)for(let n=0;n<t._entities[i].boss[s].length;n++){let l=t._entities[i].boss[s][n],c=t._map.getTile(t._entities[i].x+n,t._entities[i].y+s);"·"!=l&&"wall"!=c.name?e.draw(t._entities[i].x+n-a-10,t._entities[i].y+s-h,l,o.toRGB(t._entities[i].glyph.foreground),o.toRGB(t._entities[i].glyph.background)):t._map._tiles[t._entities[i].x+n][t._entities[i].y+s]=new r.Tile("floor","·",[0,0,0],[66,7,7])}}0==t.level&&("En"==t.lang&&(e.drawText(t._screenWidth/10,t._screenHeight-4,"%c{yellow}Arrow%c{}: move/attack"),e.drawText(t._screenWidth/10,t._screenHeight-3,"%c{yellow}Enter%c{}: pickup itens/open door"),e.drawText(t._screenWidth/10,t._screenHeight-2,"%c{yellow}Space%c{}: use weapon skill"),e.drawText(t._screenWidth/10,t._screenHeight-1,"%c{yellow}P Key%c{}: use potion")),"Pt"==t.lang&&(e.drawText(t._screenWidth/10,t._screenHeight-4,"%c{yellow}Arrow%c{}: mover/atacar"),e.drawText(t._screenWidth/10,t._screenHeight-3,"%c{yellow}Enter%c{}: pegar itens/abrir porta"),e.drawText(t._screenWidth/10,t._screenHeight-2,"%c{yellow}Space%c{}: usar habilidade da arma"),e.drawText(t._screenWidth/10,t._screenHeight-1,"%c{yellow}P Key%c{}: usar poção")))},handleInput:(e,t,i)=>{if("keydown"===e){switch(t.keyCode){case n.KEYS.VK_RETURN:let e=i._map.getItemAt(i._entities[0].x,i._entities[0].x2,i._entities[0].y,i._entities[0].y2);e.length>0?null==e[0].stairs?i._entities[0].equip(e[0]):e[0].stairs.climb():console.log("nada");break;case n.KEYS.VK_ESCAPE:i.timer=!1;break;case n.KEYS.VK_SPACE:null!=i._entities[0].equipment&&i._entities[0].equipment.strike();break;case n.KEYS.VK_LEFT:i._entities[0].stamina>=i._entities[0].maxStamina&&(i._entities[0].stamina=0,i._entities[0].move(-1,0,i._map));break;case n.KEYS.VK_DOWN:i._entities[0].stamina>=i._entities[0].maxStamina&&(i._entities[0].stamina=0,i._entities[0].move(0,1,i._map));break;case n.KEYS.VK_UP:i._entities[0].stamina>=i._entities[0].maxStamina&&(i._entities[0].stamina=0,i._entities[0].move(0,-1,i._map));break;case n.KEYS.VK_RIGHT:i._entities[0].stamina>=i._entities[0].maxStamina&&(i._entities[0].stamina=0,i._entities[0].move(1,0,i._map));break;case n.KEYS.VK_P:i._entities[0].usePotion()}if(i._player.fighter.unspentPoints>0){switch(t.keyCode){case n.KEYS.VK_A:i._player.fighter.base_power+=.5,i._player.fighter.unspentPoints-=1;break;case n.KEYS.VK_S:i._player.fighter.base_defense+=.5,i._player.fighter.unspentPoints-=1;break;case n.KEYS.VK_D:i._player.fighter.base_max_hp+=20,i._player.fighter.hp+=20,i._player.fighter.unspentPoints-=1}i._player.fighter.unspentPoints<0&&(i._player.fighter.unspentPoints=0)}}}}},t.createArena=x,t.winScreen=b,t.loseScreen=function(){return{enter:e=>{console.log("Entered lose screen."),e.endtime=Math.floor(Date.now()/6e4);let t=e.endtime-e.starttime;f.default.post("https://at-the-tsbyss-leaderboard.herokuapp.com/api/score",{name:e._player.name,score:(e._player.lastxp*(e.level>8?8+(e.level-8)/2:e.level)/Math.sqrt(t)).toFixed(2).toString(),killedby:e._player.killedby}).then(function(e){console.log(e)}).catch(function(e){console.log(e)}),e.level=0,e.starttime=0},exit:()=>{console.log("Exited lose screen.")},render:(e,t)=>{let i="[A] n d  s o . . . w e  f a l l  a g a i n . . . ?";for(let s=0;s<t.iControl;s++)e.draw(s+15,10+20*(s>18?1:0),i[s],o.toRGB([t.clr,t.clr,t.clr]),o.toRGB([0,0,0])),t.clr-=4;t.iControl<=i.length&&(t.iControl+=1),t.clr=255},handleInput:(e,t,i)=>{"keydown"===e&&(t.keyCode!==n.KEYS.VK_A&&t.keyCode!==n.KEYS.VK_R&&t.keyCode!==n.KEYS.VK_RETURN||(i.switchScreen(i.Screen.startScreen),i.clr=255,i.iControl=0))}}},t.scoreScreen=function(){return{enter:()=>{console.log("Entered score screen.")},exit:()=>{console.log("Exited score screen.")},render:(e,t)=>{e.drawText(2,2,"Name:"),e.drawText(34,2,"Score:"),e.drawText(50,2,"Killed by:");for(let i=0;i<t.scores.length;i++)0==i&&(e.drawText(4,3+i,"%c{gold}"+t.scores[i].name),e.drawText(36,3+i,"%c{gold}"+t.scores[i].score),null!=t.scores[i].killedby&&e.drawText(53,3+i,"%c{gold}"+t.scores[i].killedby)),1==i&&(e.drawText(4,3+i,"%c{#D7D7D7}"+t.scores[i].name),e.drawText(36,3+i,"%c{#D7D7D7}"+t.scores[i].score),null!=t.scores[i].killedby&&e.drawText(53,3+i,"%c{#D7D7D7}"+t.scores[i].killedby)),2==i&&(e.drawText(4,3+i,"%c{#CD7F32}"+t.scores[i].name),e.drawText(36,3+i,"%c{#CD7F32}"+t.scores[i].score),null!=t.scores[i].killedby&&e.drawText(53,3+i,"%c{#CD7F32}"+t.scores[i].killedby)),i>2&&(e.drawText(4,3+i,"%c{#A7A7AD}"+t.scores[i].name),e.drawText(36,3+i,"%c{#A7A7AD}"+t.scores[i].score),null!=t.scores[i].killedby&&e.drawText(53,3+i,"%c{#A7A7AD}"+t.scores[i].killedby))},handleInput:(e,t,i)=>{"keydown"===e&&(t.keyCode!==n.KEYS.VK_A&&t.keyCode!==n.KEYS.VK_R&&t.keyCode!==n.KEYS.VK_RETURN&&17!=t.keyCode||(i.switchScreen(i.Screen.startScreen),i.clr=255,i.iControl=0))}}},t.entityRenderSort=k,t.removeExpiredDamage=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(22),n=i(2),o=i(13),r=i(16),a=i(10),h=i(25),l=i(18),c=i(15),u=i(56),_=i(57),d=i(26),m=i(58);t.Map=class{constructor(e,t){this._width=e,this._height=t,this._tiles=[],this.dungeon_level=1,this._entities=[]}getTile(e,t){let i=new s.Tile("empty"," ",[0,0,0],[255,255,255]);return e<0||e>=this._width||t<0||t>=this._height?i:this._tiles[e][t]||i}getMovableArea(e,t,i,s){let n=!0;if(e>this._width||t>this._width||e<0||t<0)return!1;if(i>this._height||s>this._height||i<0||s<0)return!1;for(let o=e;o<=t;o++)for(let e=i;e<=s;e++)this.getTile(o,e)._isWalkable||(n=!1);return n}getEntitiesAt(e,t,i,s,n){let o=[];for(let r=0;r<this._entities.length;r++)for(let a=e;a<=t;a++)for(let e=i;e<=s;e++)(this._entities[r].x!=a&&this._entities[r].x2!=a||this._entities[r].y!=e&&this._entities[r].y2!=e)&&!(this._entities[r].x<=a&&this._entities[r].x2>=a&&this._entities[r].y<=e&&this._entities[r].y2>=e)||1!=this._entities[r].blocks||this._entities[r]==n||o.push(this._entities[r]);return o}getItemAt(e,t,i,s){let n=[];for(let o=0;o<this._entities.length;o++)for(let r=e;r<=t;r++)for(let e=i;e<=s;e++)this._entities[o].x==r&&this._entities[o].y==e&&null!=this._entities[o].item&&0==this._entities[o].item.expire&&n.push(this._entities[o]),this._entities[o].x==r&&this._entities[o].y==e&&null!=this._entities[o].stairs&&n.push(this._entities[o]);return n}getPlayer(){let e;for(let t=0;t<this._entities.length;t++)"@"==this._entities[t].glyph.char&&(e=this._entities[t]);return e}addEntityToMap(e){let t=r.from_dungeon_level([[30,1],[40,4],[40,6]],this.dungeon_level),i=r.from_dungeon_level([[10,1],[15,4]],this.dungeon_level),s=a.randint(Math.ceil(t/1.5),t),l=a.randint(Math.ceil(t/2),i),m=u.monsterProbabilities(this.dungeon_level),p=_.itemProbabilities(this.dungeon_level);for(let t=0;t<s;t++){let i=a.randint(0,this._width-1),s=a.randint(0,this._height-1),n=!0;for(;n;)Math.sqrt(Math.pow(this._entities[0].x-i,2)+Math.pow(this._entities[0].y-s,2))>20?n=!1:(i=a.randint(0,this._width-1),s=a.randint(0,this._height-1));let o=!0;for(let e=0;e<this._entities.length;e++)this._entities[e].x==i&&this._entities[e].y==s&&(o=!1);if(0==this.getTile(i,s)._isWalkable&&(o=!1),1==o){let t=r.random_choice_from_dict(m);if("dungeon"==e)for(;"fungi"==t||"ranger"==t;)t=r.random_choice_from_dict(m);let n=h.CreateMonster(t,i,s,this.dungeon_level);n._map=this,this._entities.push(n)}else t-=1}for(let e=0;e<l;e++){let t=a.randint(0,this._width-1),i=a.randint(0,this._height-1),s=!0;for(let e=0;e<this._entities.length;e++)this._entities[e].x==t&&this._entities[e].y==i&&(s=!1);if(0==this.getTile(t,i)._isWalkable&&(s=!1),1==s){let s,n=r.random_choice_from_dict(p);(s=1==e?c.CreateItem("potion",61,45,this.dungeon_level):c.CreateItem(n,t,i,this.dungeon_level))._map=this,this._entities.push(s)}else e-=1}let g=!0;for(let e=0;e<4;e++){let e=a.randint(0,this._width-1),t=a.randint(0,this._height-1);for(;g;)Math.sqrt(Math.pow(this._entities[0].x-e,2)+Math.pow(this._entities[0].y-t,2))>30&&this.getTile(e,t)._isWalkable?g=!1:(e=a.randint(0,this._width-1),t=a.randint(0,this._height-1));let i=new d.Exit(this),s=new o.Entity(e,t,new n.Glyph("⍝",[0,0,0],[20,150,200]),"saida",1,!1,-1,2,void 0,void 0,!1,void 0,void 0,void 0,i);this._entities.push(s),g=!0}return null}addBossToMap(){let e=m.CreateBoss("angel",10,10,this.dungeon_level);e._map=this,this._entities.push(e)}lightPasses(e,t){return this._tiles[e][t]._blocksLight}setupFov(e,t){new l.FOV.PreciseShadowcasting((e,t)=>(e>=this._width&&(e=this._width-1),e<=0&&(e=0),t>=this._height&&(t=this._height-1),t<=0&&(t=0),!this._tiles[e][t]._blocksLight)).compute(this._entities[0].x,this._entities[0].y,this._entities[0].sight,(i,s,n,o)=>{let r=Math.pow(this._entities[0].x-i,2),a=Math.pow(this._entities[0].y-s,2),h=Math.sqrt(r+a);if(!(i<0||i>=this._width||s<0||s>=this._height))if(0==o)this._tiles[i][s].visibility=o;else{let n=this._tiles[i][s].baseTile.foreground,r=o+.1;this._tiles[i][s].visibility=o,h<=this._entities[0].sight-2?(h<=this._entities[0].sight/2&&(this._tiles[i][s].visited=!0),r=1-h/this._entities[0].sight+.2,this._tiles[i][s].tile.foreground=[Math.floor(n[0]*r),Math.floor(n[1]*r),Math.floor(n[2]*r)]):this._tiles[i][s].tile.foreground=[Math.floor(.2*n[0]),Math.floor(.2*n[1]),Math.floor(.2*n[2])],this._display.draw(i-e,s-t,this._tiles[i][s].tile.char,l.Color.toRGB(this._tiles[i][s].tile.foreground),l.Color.toRGB([0,0,0]))}})}getFov(){return this._fov}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Sword=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=4,this.skill_bonus=.7,this.defense_bonus=0,this.hp_bonus=0,this.name="sword",this.fullname="sword",this.cooldown=12,this.max_cooldown=12,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("ރ",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+4,this.name,this.skill_bonus)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-4,this.name,this.skill_bonus)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y,this.name,this.skill_bonus)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y,this.name,this.skill_bonus)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Spear=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=3.5,this.skill_bonus=1.1,this.defense_bonus=0,this.hp_bonus=0,this.name="spear",this.fullname="spear",this.max_cooldown=10,this.cooldown=13,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("ﴽ",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+4,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+3,this.name,this.skill_bonus)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-4,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-3,this.name,this.skill_bonus)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y-1,this.name,this.skill_bonus)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y-1,this.name,this.skill_bonus)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(2),o=i(8);t.Shield=class extends s.Equipment{constructor(e,t){if(super("sub"),this.power_bonus=0,this.skill_bonus=.1,this.defense_bonus=3,this.hp_bonus=15,this.name="shield",this.fullname="shield",this.cooldown=8,this.max_cooldown=8,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown;else{let e=o.qualityGenerator("sub");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new n.Glyph("ꂷ",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}defend(e){return this.cooldown<=0&&(this.cooldown=this.max_cooldown,e=(e-=this.owner.fighter.defense()*this.skill_bonus)<0?0:e),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5);t.Potion=class extends s.Equipment{constructor(e){super("bag"),this.power_bonus=2,this.skill_bonus=.5,this.defense_bonus=0,this.hp_bonus=0,this.prefix="",this.name="potion",this.cooldown=8,this.max_cooldown=8,this.glyph=new o.Glyph("ზ",[0,0,0],[204,200,0])}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus):"n"==this.owner.face?r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus):"w"==this.owner.face?r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus):"e"==this.owner.face&&r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Firerod=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=-2,this.skill_bonus=2.5,this.defense_bonus=0,this.hp_bonus=0,this.prefix="",this.name="firerod",this.fullname="firerod",this.cooldown=12,this.max_cooldown=12,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown,this.glyph=e.glyph;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("‽",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus,"f",7),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+2,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+2,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+3,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+3,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+3,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y+4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y+4,this.name,this.skill_bonus,"f",10)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus,"f",7),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-2,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-2,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-3,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-3,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-3,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y-4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-4,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y-4,this.name,this.skill_bonus,"f",10)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus,"f",7),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y+1,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y-1,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y+1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y-1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y+2,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y+1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y-1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y-2,this.name,this.skill_bonus,"f",10)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus,"f",7),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y+1,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y-1,this.name,this.skill_bonus,"f",9),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y+1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y-1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y+2,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y+1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y-1,this.name,this.skill_bonus,"f",10),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y-2,this.name,this.skill_bonus,"f",10)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Dagger=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=1.5,this.skill_bonus=1.5,this.defense_bonus=0,this.hp_bonus=0,this.prefix="",this.name="dagger",this.fullname="dagger",this.cooldown=8,this.max_cooldown=8,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown,this.glyph=e.glyph;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("🗡",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+4,this.name,this.skill_bonus)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-3,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-4,this.name,this.skill_bonus)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y,this.name,this.skill_bonus)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y,this.name,this.skill_bonus)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Icerod=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=-2,this.skill_bonus=2.5,this.defense_bonus=0,this.hp_bonus=0,this.prefix="",this.name="icerod",this.fullname="icerod",this.cooldown=12,this.max_cooldown=12,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown,this.glyph=e.glyph;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("☦",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y+3,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+3,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+3,this.name,this.skill_bonus,"♢",10),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+3,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y+3,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+4,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+4,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+4,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+5,this.name,this.skill_bonus,"♢",8)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y-3,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-3,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-3,this.name,this.skill_bonus,"♢",10),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-3,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y-3,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-4,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-4,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-4,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-5,this.name,this.skill_bonus,"♢",8)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y+1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y-1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y+2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y+1,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y,this.name,this.skill_bonus,"♢",10),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y-1,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y-2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y+1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y,this.name,this.skill_bonus,"♢",10),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y-1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x-4,this.owner.y,this.name,this.skill_bonus,"♢",8)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y+1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y-1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y+2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y+1,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y,this.name,this.skill_bonus,"♢",10),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y-1,this.name,this.skill_bonus,"♢",9),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y-2,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y+1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y,this.name,this.skill_bonus,"♢",10),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y-1,this.name,this.skill_bonus,"♢",8),r.createDamageBlock(this.owner,this.owner.x+4,this.owner.y,this.name,this.skill_bonus,"♢",8)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.CrossedSwords=class extends s.Equipment{constructor(e,t){if(super("main"),this.power_bonus=7,this.skill_bonus=1,this.defense_bonus=-1,this.hp_bonus=0,this.prefix="",this.name="crossedswords",this.fullname="crossedswords",this.cooldown=8,this.max_cooldown=8,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown,this.glyph=e.glyph;else{let e=a.qualityGenerator("main");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,100*e.defense_bonus>13&&(this.defense_bonus+=2*Math.random()),this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("⚔",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}strike(){this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,"s"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x,this.owner.y+2,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+3,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+3,this.name,this.skill_bonus,"✖",6)):"n"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-2,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-3,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-3,this.name,this.skill_bonus,"✖",6)):"w"==this.owner.face?(r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-2,this.owner.y,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x-3,this.owner.y-1,this.name,this.skill_bonus,"✖",6)):"e"==this.owner.face&&(r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+2,this.owner.y,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y+1,this.name,this.skill_bonus,"✖",6),r.createDamageBlock(this.owner,this.owner.x+3,this.owner.y-1,this.name,this.skill_bonus,"✖",6)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Offdagger=class extends s.Equipment{constructor(e,t){if(super("sub"),this.power_bonus=1,this.skill_bonus=.5,this.defense_bonus=-.5,this.hp_bonus=-10,this.name="offdagger",this.fullname="offdagger",this.cooldown=6,this.max_cooldown=6,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown;else{let e=a.qualityGenerator("sub");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("℩",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}defend(e){return this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus)),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),n=i(7),o=i(2),r=i(5),a=i(8);t.Blademail=class extends s.Equipment{constructor(e,t){if(super("sub"),this.power_bonus=-2,this.skill_bonus=1,this.defense_bonus=3,this.hp_bonus=25,this.name="blademail",this.fullname="blademail",this.cooldown=12,this.max_cooldown=12,null!=e)this.power_bonus=e.power_bonus,this.skill_bonus=e.skill_bonus,this.defense_bonus=e.defense_bonus,this.hp_bonus=e.hp_bonus,this.name=e.name,this.fullname=e.fullname,this.max_cooldown=e.max_cooldown,this.glyph=e.glyph;else{let e=a.qualityGenerator("sub");this.power_bonus+=(this.power_bonus+t[0])*e.power_bonus,this.skill_bonus+=(this.skill_bonus+t[1]/10)*e.skill_bonus,this.defense_bonus+=(this.defense_bonus+t[2])*e.defense_bonus,this.max_cooldown-=Math.round((this.max_cooldown-.2*t[3])*e.max_cooldown),this.hp_bonus+=5*t[4],this.fullname=e.prefix+this.name,this.glyph=new o.Glyph("❂",[0,0,0],[e.alpha,e.alpha,0])}this.startCountDown()}startCountDown(){setInterval(()=>{this.cooldown>0&&this.cooldown--},100)}defend(e){return this.cooldown<=0&&(this.cooldown=this.max_cooldown,this.owner.face,new n.DamageBlock(this.skill_bonus).owner=this.owner,r.createDamageBlock(this.owner,this.owner.x,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y+1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x+1,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x,this.owner.y-1,this.name,this.skill_bonus),r.createDamageBlock(this.owner,this.owner.x-1,this.owner.y-1,this.name,this.skill_bonus)),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.Fungi=class{constructor(){this.skill_bonus=1.5,this.skills=[{name:"poison cloud",cooldown:14,maxCooldown:14},{name:"poison shield",cooldown:20,maxCooldown:20}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<1.4*this.owner.sight?this.skills[0].cooldown>=this.skills[0].maxCooldown&&(n.poison_cloud(this.owner,e,.5*this.skill_bonus),this.skills[0].cooldown=0):this.owner.wander(),t<2&&this.skills[1].cooldown>=this.skills[1].maxCooldown&&(n.poison_shield(this.owner,e,this.skill_bonus),this.skills[1].cooldown=0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.Orc=class{constructor(){this.skill_bonus=1.1,this.skills=[{name:"punch",cooldown:18,maxCooldown:18}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<this.owner.sight?(this.owner.hunt(e),t<=5&&(this.owner.x==e.x||this.owner.y==e.y)&&n.punch(this.owner,e,1.2)):this.owner.wander()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.Troll=class{constructor(){this.skill_bonus=1.3,this.skills=[{name:"smash",cooldown:20,maxCooldown:20}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<this.owner.sight?(this.owner.hunt(e),t<=5&&(this.owner.x==e.x||this.owner.y==e.y)&&n.smash(this.owner,e,this.skill_bonus)):this.owner.wander()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(10),n=i(4),o=i(11);t.Ranger=class{constructor(){this.skill_bonus=1.5,this.skills=[{name:"snipe",cooldown:24,maxCooldown:24}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),n.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));if(t<1.5*this.owner.sight&&t>9)this.owner.hunt(e),t<=9&&(this.owner.x==e.x||this.owner.y==e.y)&&o.snipe(this.owner,e,1.2);else if(t<12&&t>5){let t=e.x-this.owner.x,i=e.y-this.owner.y;Math.abs(t)>Math.abs(i)?i>0?this.owner.move(0,s.randint(1,2),this.owner._map):this.owner.move(0,s.randint(-2,-1),this.owner._map):t>0?this.owner.move(s.randint(1,2),0,this.owner._map):this.owner.move(s.randint(-2,-1),0,this.owner._map)}else t<=5?this.owner.kite(e):this.owner.wander();t<12&&o.snipe(this.owner,e,1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.Wyvern=class{constructor(){this.skill_bonus=1.5,this.skills=[{name:"windBlow",cooldown:12,maxCooldown:12}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<this.owner.sight?(this.owner.hunt(e),t<=this.owner.sight&&this.skills[0].cooldown==this.skills[0].maxCooldown&&(n.windBlow(this.owner,e,this.skill_bonus),this.skills[0].cooldown=0)):this.owner.wander()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.Dragon=class{constructor(){this.skill_bonus=14,this.skills=[{name:"fire breath",cooldown:12,maxCooldown:12},{name:"flamestrike",cooldown:20,maxCooldown:20}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<this.owner.sight?(this.owner.hunt(e),this.skills[0].cooldown>=this.skills[0].maxCooldown&&(n.firebreath(this.owner,e,.5*this.skill_bonus),this.skills[0].cooldown=0)):this.owner.wander(),t<2&&this.skills[1].cooldown>=this.skills[1].maxCooldown&&(this.owner.hunt(e),n.flamestrike(this.owner,e,this.skill_bonus),this.skills[1].cooldown=0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.Crawler=class{constructor(){this.skill_bonus=1.2,this.skills=[{name:"bite",cooldown:6,maxCooldown:6}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<this.owner.sight?(this.owner.hunt(e),t<=2&&this.skills[0].cooldown<=this.skills[0].maxCooldown&&n.bite(this.owner,e,this.skill_bonus)):this.owner.wander()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(11);t.DummyTarget=class{constructor(){this.skill_bonus=0,this.skills=[{name:"hug",cooldown:10,maxCooldown:10}]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();if(null==e)return;let t=Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2));t<this.owner.sight?(this.owner.hunt(e),t<=5&&(this.owner.x==e.x||this.owner.y==e.y)&&this.skills[0].cooldown>=this.skills[0].maxCooldown&&(n.hug(this.owner,e,0),this.skills[0].cooldown=0)):this.owner.wander()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(16);t.monsterProbabilities=function(e){return{fungi:s.from_dungeon_level([[15,1]],e),orc:s.from_dungeon_level([[40,1],[20,3],[10,6]],e),troll:s.from_dungeon_level([[10,1],[20,3],[30,5],[60,6]],e),wyvern:s.from_dungeon_level([[5,1],[20,2],[30,3],[40,5]],e),ranger:s.from_dungeon_level([[5,1],[15,2]],e),crawler:s.from_dungeon_level([[10,2],[20,5]],e),dragon:s.from_dungeon_level([[5,3],[20,6]],e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(16);t.itemProbabilities=function(e){return{potion:35,knife:s.from_dungeon_level([[10,1],[5,3]],e),dagger:s.from_dungeon_level([[10,1],[5,3]],e),sword:s.from_dungeon_level([[2,1],[10,3],[5,5]],e),spear:s.from_dungeon_level([[2,1],[10,3],[10,5]],e),firerod:s.from_dungeon_level([[5,3],[5,5]],e),icerod:s.from_dungeon_level([[5,3],[5,5]],e),crossedswords:s.from_dungeon_level([[5,3],[5,5]],e),shield:s.from_dungeon_level([[1,1],[5,2]],e),offdagger:s.from_dungeon_level([[1,1],[10,4]],e),blademail:s.from_dungeon_level([[10,5]],e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(13),n=i(2),o=i(17),r=i(59),a=i(60);t.CreateBoss=function(e,t,i,h){let l=h,c=new o.Fighter(l>8?l/3.5*1e3:1e3,l/3.5*2,l/3.5*10,l/3.5*1e3),u=r.Boss(),_=new a.Angel;return new s.Entity(t,i,new n.Glyph("!",[0,0,0],[0,153,255]),"angel",10,!0,3,2,c,_,!1,void 0,void 0,void 0,void 0,void 0,void 0,u)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Boss=function(){return["·········/)·····(\\··","····,-'~~(···‡···)~~'-.","···/      \\/' '\\/      `","··|       /_ ◡ _\\       |","··|     _(/(\\_/)\\)_     |","··|     //\\/ \\ / \\\\     |","···\\   |''··/ \\·''·|   /","····\\  )···/   \\···(  /","·····)/···/     \\···(","·····'····'-'-'-'····'"]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=i(61);t.Angel=class{constructor(){this.skill_bonus=3,this.skills=[{name:"angel ring",cooldown:15,maxCooldown:15},{name:"angel lance",cooldown:5,maxCooldown:15}],this.dir=[2,2]}startCountDown(e){var t=e,i=setInterval(()=>{t--,this.skills.forEach(e=>{e.cooldown<e.maxCooldown&&e.cooldown++}),t<0&&(0==this.owner.fighter.hp?(clearInterval(i),s.deathFunction(this.owner)):(t=this.owner.maxStamina,this.act()))},100)}act(){let e=this.owner._map.getPlayer();null!=e&&(Math.sqrt(Math.pow(e.x-this.owner.x,2)+Math.pow(e.y-this.owner.y,2)),this.dir=this.owner.angelMove(this.dir[0],this.dir[1],this.owner._map),this.skills[0].cooldown>=this.skills[0].maxCooldown&&(n.angel_ring(this.owner,e,this.skill_bonus),this.skills[0].cooldown=0),this.skills[1].cooldown>=this.skills[1].maxCooldown&&(n.angel_tri(this.owner,e,this.skill_bonus),this.skills[1].cooldown=0))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5),n=i(10);t.angel_ring=function(e,t,i){let o="angel ring",r=0,a=t.x,h=t.y,l=n.randint(0,7),c=setInterval(()=>{0!=l&&s.createDamageBlock(e,a,h+4-r,o,i,"☼",4),1!=l&&s.createDamageBlock(e,a,h-4+r,o,i,"☼",4),2!=l&&s.createDamageBlock(e,a-4+r,h,o,i,"☼",4),3!=l&&s.createDamageBlock(e,a+4-r,h,o,i,"☼",4),4!=l&&s.createDamageBlock(e,a-4+r,h-4+r,o,i,"☼",4),5!=l&&s.createDamageBlock(e,a+4-r,h-4+r,o,i,"☼",4),6!=l&&s.createDamageBlock(e,a-4+r,h+4-r,o,i,"☼",4),7!=l&&s.createDamageBlock(e,a+4-r,h+4-r,o,i,"☼",4),(r+=1)>4&&clearInterval(c)},400)},t.angel_tri=function(e,t,i){let n=t.x,o=t.y,r=e.x+5,a=e.y+5;if(n==r||o==a)return;let h=(o-a)/(n-r),l=o-n*h,c=[],u=Math.sqrt(Math.pow(r-n,2)+Math.pow(a-o,2)),_=(r-n)/u*-1,d=-99,m=-99;for(let e=0;Math.abs(e)<2*u;e+=_){let t=Math.round((r+e)*h+l),i=Math.round(r+e);t==d&&i==m||c.push([i,t]),d=t,m=i,(i<3||i>67||t<3||t>35)&&(e=9999999)}for(let t=0;t<c.length;t++)s.createDamageBlock(e,c[t][0],c[t][1],"angel lance",i,"☽",6),s.createDamageBlock(e,c[t][0]+3,c[t][1]+3,"angel lance",i,"☽",6),s.createDamageBlock(e,c[t][0]-3,c[t][1]-3,"angel lance",i,"☽",6)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(10);function n(e,t){let i,n=s.randint(4,16);for(;n%2==0;)n-=1;n=2*n-1;let o=s.randint(4,14);for(;o%2==0;)o-=1;o=2*o-1;let r=s.randint(5,e-n-1);for(;r%4!=0;)r+=1;r+=1;let a=s.randint(5,t-o-1);for(;a%4!=0;)a+=1;return i={x:r,y:a+=1,sizex:n,sizey:o}}function o(e,t){let i=e.x,s=e.y;switch(e.past){case"N":0!=t[i-1][s]&&0!=t[i-1][s-1]&&0!=t[i][s-1]&&0!=t[i+2][s-1]&&0!=t[i+2][s]&&(t[i][s]=0,t[i+1][s]=0,t[i][s+1]=0,t[i+1][s+1]=0);break;case"S":0!=t[i-1][s]&&0!=t[i-1][s+2]&&0!=t[i][s+2]&&0!=t[i+2][s+2]&&0!=t[i+2][s]&&(t[i][s]=0,t[i+1][s]=0,t[i][s+1]=0,t[i+1][s+1]=0);break;case"E":0!=t[i][s-1]&&0!=t[i+2][s-1]&&0!=t[i+2][s]&&0!=t[i+2][s+2]&&0!=t[i][s+2]&&(t[i][s]=0,t[i+1][s]=0,t[i][s+1]=0,t[i+1][s+1]=0);break;case"W":0!=t[i][s-1]&&0!=t[i-1][s-1]&&0!=t[i-1][s]&&0!=t[i-1][s+2]&&0!=t[i][s+2]&&(t[i][s]=0,t[i+1][s]=0,t[i][s+1]=0,t[i+1][s+1]=0)}}function r(e,t,i,n,o){let r=[],a=[],h=e.y,l=e.x;if(h+4<o&&1==t[l][h+4]&&1==t[l-1][h+3]&&1==t[l+2][h+3]&&a.push({x:l,y:h+2,dir:"S",past:"S"}),l+4<n&&1==t[l+4][h]&&1==t[l+3][h-1]&&1==t[l+3][h+2]&&a.push({x:l+2,y:h,dir:"E",past:"E"}),h-3>0&&1==t[l][h-3]&&1==t[l-1][h-3]&&1==t[l+2][h-3]&&a.push({x:l,y:h-2,dir:"N",past:"N"}),l-3>0&&1==t[l-3][h]&&1==t[l-3][h+2]&&1==t[l-3][h-1]&&a.push({x:l-2,y:h,dir:"W",past:"W"}),0!=a.length)if(1==a.length)r.push(a[0]);else{let e=s.randint(0,a.length-1),t=(e+1)%a.length;for(;t!=e;)r.push(a[t]),t=(t+1)%a.length;r.push(a[e])}else t[l][h]=2;return r}function a(e,t,i){let s;return"N"==e.dir&&(s={x:e.x,y:e.y-2,dir:"z",past:"N"}),"E"==e.dir&&(s={x:e.x+2,y:e.y,dir:"z",past:"E"}),"S"==e.dir&&(s={x:e.x,y:e.y+2,dir:"z",past:"S"}),"W"==e.dir&&(s={x:e.x-2,y:e.y,dir:"z",past:"W"}),s}function h(e,t,i,s){let n=0;for(;e.length>0;){let h=e.pop();if(0!=t[h.x][h.y]){if(o(h,t),(h.x-1)%4==0&&(h.y-1)%4==0){r(h,t,0,i,s).forEach(t=>{e.push(t)})}else e.push(a(h));if(1e4==(n+=1)){e=[]}}}}function l(e,t,i,s){let n=[];for(n.push(e);1==n.length;){let o={x:(e=n.pop()).x,y:e.y},r=0;e.x+2<i?t[e.x+2][e.y]>=1?r+=1:(o.x=e.x+2,n.push(o)):r+=1,e.x-2>0?t[e.x-2][e.y]>=1?r+=1:(o.x=e.x-2,n.push(o)):r+=1,e.y+2<s?t[e.x][e.y+2]>=1?r+=1:(o.y=e.y+2,n.push(o)):r+=1,e.y-2>0?t[e.x][e.y-2]>=1?r+=1:(o.y=e.y-2,n.push(o)):r+=1,r>2&&(t[e.x][e.y]=1,t[e.x+1][e.y]=1,t[e.x][e.y+1]=1,t[e.x+1][e.y+1]=1)}}t.generateDunMaze=function(e,t){let i=function(e,t){let i=[[1]];for(let s=0;s<e;s++){i.push([]);for(let e=0;e<t;e++)i[s].push(1)}return i}(e,t),o=[],r=[],a=[],c=0;for(let s=0;s<400;s++){let s=n(e,t);for(let n=s.x-1;n<=s.x+s.sizex;n++)for(let o=s.y-1;o<=s.y+s.sizey;o++)n>e||o>t?c=1:0==i[n][o]&&(n=e,c=1);if(1!=c){o.push(s);for(let e=s.x;e<=s.x+s.sizex;e++)for(let t=s.y;t<=s.y+s.sizey;t++)i[e][t]=0}c=0}for(let s=1;s<e;s+=4)for(let n=1;n<t;n+=4)1==i[s][n]&&1==i[s+1][n]&&1==i[s][n+1]&&1==i[s+1][n+1]&&(r.push({x:s,y:n,dir:"z",past:"S"}),h(r,i,e,t)),2==i[s][n]&&a.push({x:s,y:n});return function(e,t,i,n){let o=[],r=e.length;for(let a=0;a<r;a++)for(100*Math.random()>70&&o.push("n"),100*Math.random()>70&&o.push("e"),100*Math.random()>70&&o.push("s"),100*Math.random()>70&&o.push("w"),0==o.length&&o.push("z");o.length>0;){let r=[];switch(o.pop()){case"n":if(e[a].y-3>0){for(let i=0;i<e[a].sizex;i+=2)if(t[e[a].x+i][e[a].y-3]<1)r.push(i);else if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x+r[i]][e[a].y-1]=0,t[e[a].x+r[i]+1][e[a].y-1]=0,t[e[a].x+r[i]][e[a].y-2]=0,t[e[a].x+r[i]+1][e[a].y-2]=0,r=[]}if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x+r[i]][e[a].y-1]=0,t[e[a].x+r[i]+1][e[a].y-1]=0,t[e[a].x+r[i]][e[a].y-2]=0,t[e[a].x+r[i]+1][e[a].y-2]=0,r=[]}}break;case"e":if(e[a].x+e[a].sizex+3<i){for(let i=0;i<e[a].sizey;i+=2)if(t[e[a].x+e[a].sizex+3][e[a].y+i]<1)r.push(i);else if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x+e[a].sizex+1][e[a].y+r[i]]=0,t[e[a].x+e[a].sizex+2][e[a].y+r[i]]=0,t[e[a].x+e[a].sizex+1][e[a].y+r[i]+1]=0,t[e[a].x+e[a].sizex+2][e[a].y+r[i]+1]=0,r=[]}if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x+e[a].sizex+1][e[a].y+r[i]]=0,t[e[a].x+e[a].sizex+2][e[a].y+r[i]]=0,t[e[a].x+e[a].sizex+1][e[a].y+r[i]+1]=0,t[e[a].x+e[a].sizex+2][e[a].y+r[i]+1]=0,r=[]}}break;case"s":if(e[a].y+3<n){for(let i=0;i<e[a].sizex;i+=2)if(t[e[a].x+i][e[a].y+3+e[a].sizey]<1)r.push(i);else if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x+r[i]][e[a].y+1+e[a].sizey]=0,t[e[a].x+r[i]+1][e[a].y+1+e[a].sizey]=0,t[e[a].x+r[i]][e[a].y+2+e[a].sizey]=0,t[e[a].x+r[i]+1][e[a].y+2+e[a].sizey]=0,r=[]}if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x+r[i]][e[a].y+1+e[a].sizey]=0,t[e[a].x+r[i]+1][e[a].y+1+e[a].sizey]=0,t[e[a].x+r[i]][e[a].y+2+e[a].sizey]=0,t[e[a].x+r[i]+1][e[a].y+2+e[a].sizey]=0,r=[]}}break;case"w":if(e[a].x-3>0){for(let i=0;i<e[a].sizey;i+=2)if(t[e[a].x-3][e[a].y+i]<1)r.push(i);else if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x-1][e[a].y+r[i]]=0,t[e[a].x-2][e[a].y+r[i]]=0,t[e[a].x-1][e[a].y+r[i]+1]=0,t[e[a].x-2][e[a].y+r[i]+1]=0,r=[]}if(r.length>0){let i=s.randint(0,r.length-1);t[e[a].x-1][e[a].y+r[i]]=0,t[e[a].x-2][e[a].y+r[i]]=0,t[e[a].x-1][e[a].y+r[i]+1]=0,t[e[a].x-2][e[a].y+r[i]+1]=0,r=[]}}break;default:a--}}}(o,i,e,t),function(e,t,i,s){e.push({x:1,y:1});let n=e.length,o=0;for(let r=0;r<n;r+=1){let n=0;e[r].x+2<i?1==t[e[r].x+2][e[r].y]&&(n+=1):n+=1,e[r].x-2>0?1==t[e[r].x-2][e[r].y]&&(n+=1):n+=1,e[r].y+2<s?1==t[e[r].x][e[r].y+2]&&(n+=1):n+=1,e[r].y-2>0?1==t[e[r].x][e[r].y-2]&&(n+=1):n+=1,n>2?(o+=1,l(e[r],t,i,s),t[e[r].x][e[r].y]=1):t[e[r].x][e[r].y]=0}}(a,i,e,t),i}},function(e,t,i){e.exports=i(64)},function(e,t,i){"use strict";var s=i(3),n=i(27),o=i(66),r=i(33);function a(e){var t=new o(e),i=n(o.prototype.request,t);return s.extend(i,o.prototype,t),s.extend(i,t),i}var h=a(i(30));h.Axios=o,h.create=function(e){return a(r(h.defaults,e))},h.Cancel=i(34),h.CancelToken=i(78),h.isCancel=i(29),h.all=function(e){return Promise.all(e)},h.spread=i(79),e.exports=h,e.exports.default=h},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,i){"use strict";var s=i(3),n=i(28),o=i(67),r=i(68),a=i(33);function h(e){this.defaults=e,this.interceptors={request:new o,response:new o}}h.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=a(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var t=[r,void 0],i=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)i=i.then(t.shift(),t.shift());return i},h.prototype.getUri=function(e){return e=a(this.defaults,e),n(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},s.forEach(["delete","get","head","options"],function(e){h.prototype[e]=function(t,i){return this.request(s.merge(i||{},{method:e,url:t}))}}),s.forEach(["post","put","patch"],function(e){h.prototype[e]=function(t,i,n){return this.request(s.merge(n||{},{method:e,url:t,data:i}))}}),e.exports=h},function(e,t,i){"use strict";var s=i(3);function n(){this.handlers=[]}n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){s.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(69),o=i(29),r=i(30),a=i(76),h=i(77);function l(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return l(e),e.baseURL&&!a(e.url)&&(e.url=h(e.baseURL,e.url)),e.headers=e.headers||{},e.data=n(e.data,e.headers,e.transformRequest),e.headers=s.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),s.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||r.adapter)(e).then(function(t){return l(e),t.data=n(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(l(e),t&&t.response&&(t.response.data=n(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,i){"use strict";var s=i(3);e.exports=function(e,t,i){return s.forEach(i,function(i){e=i(e,t)}),e}},function(e,t,i){"use strict";var s=i(3);e.exports=function(e,t){s.forEach(e,function(i,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[s])})}},function(e,t,i){"use strict";var s=i(32);e.exports=function(e,t,i){var n=i.config.validateStatus;!n||n(i.status)?e(i):t(s("Request failed with status code "+i.status,i.config,null,i.request,i))}},function(e,t,i){"use strict";e.exports=function(e,t,i,s,n){return e.config=t,i&&(e.code=i),e.request=s,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,i){"use strict";var s=i(3),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,i,o,r={};return e?(s.forEach(e.split("\n"),function(e){if(o=e.indexOf(":"),t=s.trim(e.substr(0,o)).toLowerCase(),i=s.trim(e.substr(o+1)),t){if(r[t]&&n.indexOf(t)>=0)return;r[t]="set-cookie"===t?(r[t]?r[t]:[]).concat([i]):r[t]?r[t]+", "+i:i}}),r):r}},function(e,t,i){"use strict";var s=i(3);e.exports=s.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function n(e){var s=e;return t&&(i.setAttribute("href",s),s=i.href),i.setAttribute("href",s),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return e=n(window.location.href),function(t){var i=s.isString(t)?n(t):t;return i.protocol===e.protocol&&i.host===e.host}}():function(){return!0}},function(e,t,i){"use strict";var s=i(3);e.exports=s.isStandardBrowserEnv()?{write:function(e,t,i,n,o,r){var a=[];a.push(e+"="+encodeURIComponent(t)),s.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),s.isString(n)&&a.push("path="+n),s.isString(o)&&a.push("domain="+o),!0===r&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,i){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,i){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,i){"use strict";var s=i(34);function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var i=this;e(function(e){i.reason||(i.reason=new s(e),t(i.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e;return{token:new n(function(t){e=t}),cancel:e}},e.exports=n},function(e,t,i){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Messagelog=class{constructor(e,t,i,s){this.messages=[],this.x=e,this.width=t,this.height=i,this.game=s}addMessage(e){this.messages.length==this.height&&this.messages.shift(),this.messages.push(e)}newMessage(e,t,i,s,n=""){let o={message:"",type:t,color0:e.glyph.foreground,color1:null==i?[255,255,255]:i.glyph.foreground,color2:null==s?[255,255,255]:s.glyph.foreground};switch(this.game.lang){case"En":if("pickup"==t&&(o.message="%c{0}"+e.name+"%c{base} got: %c{1}"+i.name+"%c{base} !"),"switchEquip"==t&&(o.color2=e.equipment.glyph.foreground,o.message="%c{0}"+e.name+"%c{base} switched: %c{1}"+i.name.toString()+"%c{base} for: %c{2}"+s.name.toString()+" %c{base}!"),"fight"==t){let t=n;o.message="%c{0}"+e.name+"%c{base} hit %c{1}"+i.name+"%c{base} and dealt "+t+" damage! ("+i.fighter.hp.toFixed(2)+")"}if("fightZeroDamage"==t&&(o.message="%c{0}"+e.name+"%c{base} hit %c{1}"+i.name+"%c{base}, but it was ineffective!"),"skill"==t){let t=n;o.message="%c{0}"+e.name+"%c{base} used %c{2}"+s.name+"%c{base}, on %c{1}"+i.name+"%c{base} and caused "+t+" damage! ("+i.fighter.hp.toFixed(2)+")"}"skillZeroDamage"==t&&(o.message="%c{0}"+e.name+"%c{base} hit %c{2}"+s.name+"%c{base}, but it was ineffective!"),"potion"==t&&(o.color1=[0,255,120],o.message="%c{0}"+e.name+"%c{base} used a %c{1}Potion%c{base}, regenerating "+(.35*e.fighter.max_hp()).toFixed(0)+" of hp!"),"potionZero"==t&&(o.color1=[0,255,120],o.message="%c{0}"+e.name+"%c{base} have no %c{1}Potion%c{base} to use!"),"death"==t&&(o.message="%c{0}"+e.name+"%c{1} died");break;case"Pt":if("pickup"==t&&(o.message="%c{0}"+e.name+"%c{base} empunhou: %c{1}"+i.name+"%c{base} !"),"switchEquip"==t&&(o.message="%c{0}"+e.name+"%c{base} trocou: %c{1}"+i.name.toString()+"%c{base} por: %c{2}"+e.equipment.name.toString()+" %c{base}!"),"fight"==t){let t=n;o.message="%c{0}"+e.name+"%c{base} bateu em %c{1}"+i.name+"%c{base} com "+t+" de dano! ("+i.fighter.hp.toFixed(2)+")"}if("fightZeroDamage"==t&&(o.message="%c{0}"+e.name+"%c{base} bateu em %c{1}"+i.name+"%c{base}, mas não causou dano!"),"skill"==t){let t=n;o.message="%c{0}"+e.name+"%c{base} usou %c{2}"+s.name+"%c{base} em %c{1}"+i.name+"%c{base} com "+t+" de dano! ("+i.fighter.hp.toFixed(2)+")"}"skillZeroDamage"==t&&(o.message="%c{0}"+e.name+"%c{base} bateu em %c{2}"+s.name+"%c{base}, mas não causou dano!"),"potion"==t&&(o.color1=[0,255,120],o.message="%c{0}"+e.name+"%c{base} usou uma %c{1}Poção%c{base}, regenerando "+(.35*e.fighter.max_hp()).toFixed(0)+" de vida!"),"potionZero"==t&&(o.color1=[0,255,120],o.message="%c{0}"+e.name+"%c{base} não tem %c{1}Poção%c{base} pra usar!"),"death"==t&&(o.message="%c{0}"+e.name+"%c{1} morreu")}this.addMessage(o)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logo=function(){return["%c{black}.%c{}.  . `  .: . :. : .  . :.  .  . . .     . .    '    '' .  .  . ..  ","%c{black}.%c{}.  :` . :   .  .'.' '....xxxxx...,'. '   ' .     ..","%c{black}.%c{} ` . : . .' :  . ..XXXXXXXXXXXXXXXXXXXXx.    `     . ",".    .  . . .   ..XXXXXXXXWWWWWWWWWWWWWWWWXX.  .     .     ","%c{black}.%c{}' : . : .  ...XXXXXWWW'  W88N88@888888WWWWWXX.   .   .       . .",". ' .   :...XXXXXXWWW'  M88N88GGGGGG88888M 'WMBX.          .   ..  :","%c{black}.%c{}:  ..XXXXXXXXWWW'     M88888WWRWWW W8oo88M   WWMX.     .    :    .","%c{black}.%c{} XXXXXXXXXXXXWW'       WN8888WWWW   WW8@@@8M    BMBRX.         .  : :",".XXXXXXXX=MMWW':  .      W8N888WWWW ,WW88888W      XRBRXX.  .       .","%c{black}.%c{}.'XXXXXMM::::. .        W8@889WWWWWM8@8N8W    . . :RRXx.    .","%c{black}.%c{} ``.''  MMM::.:.  .      W888N89999888@8W   . . ::::'RXV    .  :",".      ..'''MMMm::.  .      WW888N88888WW  .  . mmMMMMMRXx","%c{black}.%c{}.'.        ''MMmm .  .       WWWWWWW   . :. :,miMM'''  : ''`    .",".             .   ''MMMMmm . .  .  .   ._,mMMMM'''  :  ' .  :","%c{black}.%c{}    .                  ''MMMMMMMMMMMMM''' .  : . '   .        .","%c{black}.%c{}  .           .     .    .                      .         .",".                                   .          .         ."]}}]);
//# sourceMappingURL=bundle.js.map